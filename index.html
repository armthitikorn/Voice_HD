<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>แบบทดสอบการพูดและการบันทึกเสียง</title>
<link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&amp;display=swap" rel="stylesheet"/>
<style>
        body {
            font-family: 'Sarabun', sans-serif;
            background-color: #f4f7f6;
            margin: 0;
            padding: 20px;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: auto;
            background: #fff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
        }
        header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 15px;
        }
        h1 {
            color: #007bff;
            font-weight: 700;
        }
        .user-info {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            align-items: center;
        }
        .user-info label {
            font-weight: 700;
        }
        .user-info input {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            flex-grow: 1;
            font-size: 16px;
        }
        .part-selection {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
        }
        .part-button {
            padding: 12px 25px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 700;
            transition: background-color 0.3s;
        }
        .part-button:hover {
            background-color: #1e7e34;
        }
        .part-button.active {
            background-color: #0056b3;
        }
        .exam-area {
            display: flex; 
            gap: 20px;
            min-height: 500px;
        }
        .question-list {
            flex: 0 0 250px;
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            max-height: 500px;
            overflow-y: auto;
        }
        .question-item {
            padding: 10px;
            margin-bottom: 5px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .question-item:hover {
            background-color: #e9ecef;
        }
        .question-item.active {
            background-color: #007bff;
            color: white;
            font-weight: 700;
        }
        .status-icon {
            font-size: 18px;
            line-height: 1;
            margin-left: 10px;
        }
        .question-content {
            flex: 1;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .question-content h3 {
            margin-top: 0;
            color: #dc3545;
        }
        
        /* สไตล์สำหรับ Q&A */
        .prompt-area {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ff9800;
            border-radius: 8px;
            background-color: #fff3e0;
        }
        .response-area {
            margin-bottom: 20px;
            padding: 15px;
            border: 2px solid #28a745;
            border-radius: 8px;
            background-color: #e8f5e9;
        }
        .response-area p {
            font-size: 18px;
            line-height: 1.6;
            font-weight: 600; /* เน้นสคริปต์ให้อ่านง่าย */
            white-space: pre-wrap;
        }
        .recording-area {
            margin-top: 25px;
            padding: 15px;
            border: 1px dashed #007bff;
            border-radius: 6px;
            text-align: center;
        }
        .recording-area button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 700;
            transition: background-color 0.3s;
        }
        #startRecBtn {
            background-color: #dc3545;
            color: white;
        }
        #startRecBtn:hover {
            background-color: #c82333;
        }
        #stopRecBtn {
            background-color: #ffc107;
            color: #333;
        }
        #stopRecBtn:hover {
            background-color: #e0a800;
        }
        #playbackAudio {
            width: 100%;
            margin-top: 15px;
        }
        .controls {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        .controls button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 700;
            transition: background-color 0.3s;
            background-color: #007bff;
            color: white;
            flex-basis: 48%; /* เพื่อให้ปุ่มแบ่งพื้นที่ */
        }
        .controls button:hover {
            background-color: #0056b3;
        }

        #submitBtn {
            background-color: #28a745;
            color: white;
            padding: 15px 30px;
            width: 100%;
            margin-top: 30px;
            font-size: 18px;
        }
        .alert {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
            font-weight: 700;
            display: none;
        }
        .alert.warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
        }
        .alert.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            font-size: 24px;
            color: #007bff;
            font-weight: 700;
        }
    
@media (max-width: 768px) {
  .container {
    padding: 15px !important;
  }
  .user-info, .part-selection {
    flex-direction: column !important;
    gap: 10px !important;
  }
  .exam-area {
    flex-direction: column !important;
  }
  .question-list {
    flex: 1 1 100% !important;
    max-height: 200px !important;
  }
  .question-content {
    padding: 15px !important;
  }
  .recording-area button {
    width: 100% !important;
  }
  .controls {
    flex-direction: row !important; /* ให้ปุ่มนำทางยังอยู่แถวเดียว */
    gap: 10px !important;
  }
  #submitBtn {
    width: 100% !important;
  }
}
</style>
</head>
<body>
<div class="container">
<header>
<h1>ระบบบันทึกเสียงแบบทดสอบ (Q&amp;A Script)</h1>
<p>โจทย์: พนักงานอ่าน **คำถาม (Q)** ในใจ และพูด **คำตอบ (A)** ออกมาเพื่อบันทึกเสียง</p>
</header>
<div class="alert" id="mainAlert"></div>
<div class="user-info">
<label for="inputUserName">ชื่อ-นามสกุล/รหัสพนักงาน:</label>
<input id="inputUserName" placeholder="กรุณากรอกชื่อ-รหัสพนักงาน" type="text"/>
</div>
<div class="part-selection">
<button class="part-button" id="btnPart1" onclick="loadPart('part1')">Part 1 (30 ข้อ)</button>
<button class="part-button" id="btnPart2" onclick="loadPart('part2')">Part 2 (30 ข้อ)</button>
<button class="part-button" id="btnPart3" onclick="loadPart('part3')">Part 3 (30 ข้อ)</button>
</div>
<div class="exam-area" id="examArea" style="display: none;">
<div class="question-list" id="questionList">
</div>
<div class="question-content">
<h3 id="currentQuestionTitle">กรุณาเลือก Part ที่ต้องการทำ</h3>
<div class="prompt-area">
<h4 class="font-bold text-lg text-orange-700">คำถาม (โจทย์ที่ลูกค้าถาม):</h4>
<p class="text-xl font-medium text-gray-800" id="questionPrompt">คำแนะนำ: เลือก Part ด้านบนเพื่อเริ่มทำแบบทดสอบ</p>
</div>
<div class="response-area">
<h4 class="font-bold text-lg text-green-700">คำตอบที่ต้องพูด (Script สำหรับบันทึก):</h4>
<p class="text-xl text-gray-900 font-semibold italic" id="requiredAnswer">เมื่อเลือก Part แล้ว สคริปต์คำตอบจะปรากฏที่นี่</p>
</div>
<div class="recording-area">
<p id="recordingStatus">สถานะ: ยังไม่ได้เริ่มบันทึกเสียง</p>
<button id="startRecBtn" onclick="handleStartRecording()">เริ่มบันทึกเสียง (Rec)</button>
<button disabled="" id="stopRecBtn" onclick="handleStopRecording()">หยุดบันทึก (Stop)</button>
<audio controls="" id="playbackAudio"></audio>
</div>
<div class="controls">
<button id="prevBtn" onclick="prevQuestion()">← ก่อนหน้า</button>
<button id="nextBtn" onclick="nextQuestion()">ถัดไป →</button>
</div>
</div>
</div>
<button disabled="" id="submitBtn" onclick="submitExam()">ส่งคำตอบทั้งหมด</button>
</div>
<div class="loading-overlay" id="loadingOverlay">
        กำลังอัปโหลดไฟล์เสียง... โปรดรอสักครู่
    </div>
<script type="module">

// --- Supabase Imports & Config ---
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';
import { v4 as uuidv4 } from 'https://cdn.jsdelivr.net/npm/uuid@8.3.2/dist/esm-browser/index.js';

// **โปรดเปลี่ยน URL และ Key ให้เป็นของโครงการคุณ**
const supabaseUrl = 'https://wzwyotzzxycqfwercakh.supabase.co';
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Ind6d3lvdHp6eHljcWZ3ZXJjYWtoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcwNTg3MTMsImV4cCI6MjA3MjYzNDcxM30.lgiAf9oBUqsaWGb3u_80wuoKAODQHE_lIBxpGumhrno';
const supabase = createClient(supabaseUrl, supabaseKey);

// --- Q&A Data (ย้ายมาไว้ด้านบน) ---
const questions = {
    part1: [
        // Part 1: Sales & Pricing Objections (Q1-Q30)
        { id: "P1Q1", part: 1, q: "แพงไปหน่อยนะ ลดราคาได้ไหม?",  a: "เข้าใจเลยค่ะว่ากังวลเรื่องราคา แต่สิ่งที่คุณกำลังลงทุนนี้คือ **คุณภาพ** และ **ผลลัพธ์ที่ยั่งยืน** ซึ่งเรามีบริการหลังการขายและฟีเจอร์ที่คู่แข่งไม่มี เมื่อเทียบกับมูลค่าที่คุณจะได้รับ ถือว่าคุ้มค่ามากค่ะ" },
        { id: "P1Q2", part: 1, q: "ตอนนี้ยุ่งอยู่ โทรมาใหม่ได้ไหม?", a: "ขออนุญาตใช้เวลา **30 วินาที** สรุปสาระสำคัญที่คุณจะได้รับประโยชน์ได้ไหมคะ? หากไม่สนใจ ดิฉันจะวางสายทันทีค่ะ (รอการตอบรับ) ขอบคุณค่ะ สิ่งนี้จะช่วยคุณ..." },
        { id: "P1Q3", part: 1, q: "ขอปรึกษาคนในครอบครัว/หัวหน้าก่อนนะ", a: "เป็นเรื่องที่ดีเลยค่ะที่ปรึกษาผู้มีส่วนเกี่ยวข้อง ดิฉันขออนุญาตสรุปจุดเด่น 3 ข้อ เพื่อให้คุณนำไปนำเสนอได้ง่ายขึ้นนะคะ? มีอะไรที่ต้องชี้แจงเพิ่มเติมไหมคะ?" },
        { id: "P1Q4", part: 1, q: "ไม่สนใจสินค้าประเภทนี้เลย", a: "ดิฉันเข้าใจค่ะ แต่ผลิตภัณฑ์นี้ถูกออกแบบมาเพื่อช่วย **แก้ปัญหา A, B, C** ซึ่งหลายคนก็คิดว่าไม่สนใจ จนกระทั่งได้ลองฟัง... ขออนุญาตแนะนำสิ่งที่จะช่วยประหยัดเวลา/เงินให้คุณ 5 นาทีนะคะ?" },
        { id: "P1Q5", part: 1, q: "ฉันเคยใช้บริการแบบนี้แล้ว ไม่เห็นผล", a: "ขออภัยที่ประสบการณ์เดิมไม่ดีค่ะ ดิฉันเข้าใจความรู้สึกของคุณเลย แต่ของเรามีการปรับปรุงในส่วนของ **'กระบวนการทำงาน/วัตถุดิบ/เทคโนโลยี'** ทำให้มั่นใจว่าคุณจะเห็นผลที่แตกต่างแน่นอนค่ะ" },
        { id: "P1Q6", part: 1, q: "ไม่มีงบประมาณสำหรับสิ่งนี้", a: "ดิฉันเข้าใจเรื่องงบประมาณค่ะ แต่เมื่อเทียบกับ **ประโยชน์ (Value) หรือผลตอบแทน (ROI)** ที่คุณจะได้รับภายใน 3 เดือนข้างหน้าแล้ว จะพบว่านี่คือการลงทุนที่คุ้มค่าที่สุด เรามีทางเลือกให้ผ่อนชำระได้ด้วยนะคะ" },
        { id: "P1Q7", part: 1, q: "ฉันซื้อจากเจ้าอื่นไปแล้ว", a: "ยินดีด้วยค่ะ! ถือเป็นการตัดสินใจที่ดีเยี่ยมเลย ขออนุญาตสอบถามเผื่อเป็นทางเลือกสำรองได้ไหมคะ? ในกรณีที่คุณต้องการขยายหรือหา **ทางเลือกที่มีความยืดหยุ่นกว่า** ในอนาคต" },
        { id: "P1Q8", part: 1, q: "ฉันไม่ว่างคุยนะ", a: "ขออภัยที่รบกวนค่ะ เข้าใจว่าคุณลูกค้ามีงานสำคัญที่ต้องจัดการ ถ้าเช่นนั้น สะดวกให้ดิฉันโทรกลับกี่โมงดีคะ? หรือพรุ่งนี้ช่วงเช้าดีกว่าคะ?" },
        { id: "P1Q9", part: 1, q: "ขอส่งข้อมูลทางอีเมลมาให้ดูก่อน", a: "ดิฉันยินดีส่งข้อมูลให้ค่ะ แต่ขออนุญาตอธิบายสั้นๆ เพียง 2 นาที เพื่อให้คุณเห็นภาพรวมและ **เลือกไฟล์ที่เกี่ยวข้อง** กับความต้องการของคุณได้ถูก จะช่วยประหยัดเวลาคุณได้มากเลยค่ะ" },
        { id: "P1Q10", part: 1, q: "ฉันไม่เชื่อว่าผลิตภัณฑ์คุณจะดีจริง", a: "ดิฉันเข้าใจค่ะ การเชื่อในสิ่งที่ยังไม่เห็นเป็นเรื่องยาก แต่เรามี **การรับประกันคืนเงิน** ภายใน 30 วัน หรือผลลัพธ์จากลูกค้า (Testimonials) ที่มีปัญหาคล้ายคุณให้ดูค่ะ ขออนุญาตส่งข้อมูลการันตีให้ดูนะคะ" },
        { id: "P1Q11", part: 1, q: "นานเกินไป เสียเวลา", a: "ขออภัยค่ะ ดิฉันจะตัดเข้าประเด็นสำคัญที่เกี่ยวกับคุณลูกค้าทันทีเลยนะคะ (ลดความเร็วในการพูด) สิ่งที่เราจะเสนอนี้จะช่วยให้คุณ **ประหยัดเวลา/เงิน ได้ X%** นี่คือสิ่งที่คุณมองหาใช่ไหมคะ?" },
        { id: "P1Q12", part: 1, q: "ไม่มีความจำเป็นต้องใช้", a: "ถ้าเช่นนั้น ขออนุญาตแนะนำสิ่งที่อาจจะช่วยให้คุณ **ป้องกันปัญหา** ที่อาจเกิดขึ้นในอนาคต เช่น (ยกตัวอย่างปัญหา) เราไม่ได้ขายสิ่งที่จำเป็นวันนี้ แต่ขายสิ่งที่จำเป็นในวันหน้าค่ะ" },
        { id: "P1Q13", part: 1, q: "ไม่ตอบคำถาม (เงียบไป)", a: "คุณลูกค้ายังอยู่กับดิฉันไหมคะ? (รอ 5 วินาที) ขออนุญาตสรุปประเด็นที่เราคุยกันได้ไหมคะว่า **ข้อเสนอของเราช่วยคุณได้อย่างไร?**" },
        { id: "P1Q14", part: 1, q: "ฉันจะติดต่อกลับไปเอง", a: "ขอบคุณค่ะ เพื่อความรวดเร็ว ดิฉันขออนุญาตส่ง **เบอร์โทรตรง** และ **Line Official** ของดิฉันไว้ให้คุณลูกค้าติดต่อกลับได้สะดวกกว่านะคะ" },
        { id: "P1Q15", part: 1, q: "คู่แข่งของคุณถูกกว่ามากเลยนะ", a: "ดิฉันเข้าใจค่ะ แต่เราไม่ได้แข่งขันแค่เรื่องราคา เราแข่งขันด้วย **มูลค่า** และ **ความน่าเชื่อถือ** ที่เรามอบให้ หากมองในระยะยาว ผลิตภัณฑ์ของเราจะให้ผลตอบแทนที่ดีกว่ามากค่ะ" },
        { id: "P1Q16", part: 1, q: "ไม่มีเงินสดเลย จ่ายเป็นผ่อนได้ไหม?", a: "ทางเราเข้าใจเรื่องสภาพคล่องค่ะ เรามีตัวเลือก **ผ่อนชำระ 0%** หรือ **แพ็กเกจรายเดือน** ที่ยืดหยุ่น เพื่อให้คุณเริ่มใช้งานได้ทันทีโดยไม่เป็นภาระหนักเกินไปค่ะ" },
        { id: "P1Q17", part: 1, q: "ฉันต้องรอเงินเดือนออกก่อน", a: "ไม่มีปัญหาเลยค่ะ เพื่อไม่ให้คุณพลาดโอกาสที่ดีที่สุด ดิฉันขออนุญาตส่ง **ข้อเสนอแบบจำกัดเวลา** นี้ไว้ให้ก่อน พร้อมระบุวันที่คาดว่าจะสะดวกโอนเงินได้ไหมคะ?" },
        { id: "P1Q18", part: 1, q: "ไม่ชอบการซื้อของผ่านโทรศัพท์/ออนไลน์", a: "ดิฉันเข้าใจค่ะ เรามีบริการที่หลากหลาย คุณสะดวกให้เราส่ง **พนักงานเข้าไปนำเสนอ** หรือมาเยี่ยมชม **โชว์รูม** ของเราเพื่อให้คุณตรวจสอบสินค้าจริงด้วยตัวเองไหมคะ?" },
        { id: "P1Q19", part: 1, q: "ต้องใช้เวลานานแค่ไหนกว่าจะเห็นผล?", a: "จากประสบการณ์ลูกค้าที่มีปัญหาคล้ายคุณ ส่วนใหญ่จะเริ่มเห็น **ผลลัพธ์ที่เป็นรูปธรรม** ภายใน **2-4 สัปดาห์** ค่ะ แต่ผลลัพธ์จะชัดเจนที่สุดคือภายใน 3 เดือน" },
        { id: "P1Q20", part: 1, q: "ขอลองใช้ฟรี (Free Trial) ก่อนได้ไหม?", a: "น่าเสียดายที่ผลิตภัณฑ์นี้ไม่มีทดลองใช้ฟรีค่ะ แต่เรามี **การรับประกันคืนเงิน 100%** ภายใน 30 วัน ถ้าไม่พอใจ หรือคุณสามารถเลือก **แพ็กเกจเริ่มต้นราคาถูก** เพื่อทดสอบก่อนได้ค่ะ" },
        { id: "P1Q21", part: 1, q: "มีแต่ข้อมูลเยอะไปหมด ตัดสินใจไม่ถูก", a: "ดิฉันเข้าใจค่ะว่าข้อมูลเยอะไปหมด ขออนุญาตสรุปให้เหลือเพียง **ทางเลือกที่ดีที่สุด 2-3 ทาง** ที่ตรงกับความต้องการหลักของคุณตอนนี้เลยได้ไหมคะ? จะช่วยให้ตัดสินใจง่ายขึ้นค่ะ" },
        { id: "P1Q22", part: 1, q: "ติดวันหยุดยาว ค่อยคุยกันหลังปีใหม่นะ", a: "แน่นอนค่ะ แต่สำหรับลูกค้าที่ตัดสินใจก่อนสิ้นปีนี้ จะได้รับ **ส่วนลด/โบนัสพิเศษ** ที่มูลค่ารวมกว่า 5,000 บาท ดิฉันขออนุญาตสรุปข้อเสนอนี้ให้คุณพิจารณาตอนนี้เลยนะคะ" },
        { id: "P1Q23", part: 1, q: "คุณโทรมาจากไหน?", a: "ดิฉันโทรมาจาก **บริษัท (ชื่อบริษัท)** ค่ะ เพื่อนำเสนอ **โซลูชัน (ชื่อโซลูชัน)** ที่ออกแบบมาโดยเฉพาะเพื่อช่วยคุณ **ลดต้นทุน/เพิ่มยอดขาย** ได้อย่างเห็นผลค่ะ" },
        { id: "P1Q24", part: 1, q: "ขอเบอร์โทรกลับของคุณด้วย", a: "ได้เลยค่ะ เบอร์โทรตรงของดิฉันคือ **02-XXX-XXXX ต่อ XXXX** ดิฉันชื่อ **(ชื่อ-นามสกุล)** ค่ะ แต่เพื่อความรวดเร็ว หากมีคำถามด่วน คุณลูกค้าสามารถสอบถามผ่านช่องทาง Line Official ได้ทันทีเลยนะคะ" },
        { id: "P1Q25", part: 1, q: "ฉันมีปัญหาที่สำคัญกว่านี้ที่ต้องจัดการ", a: "ดิฉันเข้าใจค่ะ ถ้าอย่างนั้น ขออนุญาตโทรกลับไปในวันที่คุณลูกค้าสะดวกที่สุดเพื่อมาช่วยแก้ปัญหาที่คุณมีในวันนี้ได้ไหมคะ? **(เสนอทางเลือก 2 ทางเลือก)**" },
        { id: "P1Q26", part: 1, q: "ผลิตภัณฑ์ของคุณซับซ้อนเกินไป ฉันใช้ไม่เป็น", a: "ไม่ต้องกังวลเลยค่ะ เรามี **ทีมผู้เชี่ยวชาญ** ที่พร้อมช่วยติดตั้งและสอนการใช้งานตั้งแต่เริ่มต้นจนคุณใช้เป็น โดยมี **วิดีโอสอน** และ **คู่มือภาษาไทย** ให้ศึกษาตลอดเวลาค่ะ" },
        { id: "P1Q27", part: 1, q: "ฉันไม่เคยได้ยินชื่อบริษัทคุณเลย", a: "ดิฉันเข้าใจค่ะ บริษัทเราอาจจะใหม่สำหรับคุณ แต่เรามี **ประสบการณ์กว่า 5 ปี** และมี **ลูกค้ารายใหญ่ (ยกตัวอย่าง 1-2 ราย)** ที่ให้ความไว้วางใจค่ะ ขออนุญาตส่งข้อมูลบริษัทให้ดูนะคะ" },
        { id: "P1Q28", part: 1, q: "ฉันไม่รู้ว่าจะใช้สินค้าของคุณทำอะไรดี", a: "สินค้าของเราสามารถช่วยแก้ปัญหาหลัก 3 ข้อคือ **1. ประหยัดเวลา 2. ลดค่าใช้จ่าย 3. เพิ่มประสิทธิภาพ** หากดิฉันสามารถแสดงให้เห็นว่ามันทำงานกับงานของคุณได้อย่างไร คุณจะสนใจไหมคะ?" },
        { id: "P1Q29", part: 1, q: "ฉันไม่มีอำนาจตัดสินใจเรื่องนี้", a: "ขอบคุณที่แจ้งให้ทราบค่ะ ขออนุญาตสอบถามว่า **ใครคือผู้มีอำนาจตัดสินใจสูงสุด** ที่ดิฉันควรจะติดต่อด้วยคะ? ดิฉันยินดีนัดหมายเพื่อนำเสนอโดยตรงให้ท่านได้พิจารณาค่ะ" },
        { id: "P1Q30", part: 1, q: "ฉันไม่เชื่อว่าราคาที่คุณเสนอนี้เป็นราคาที่ดีที่สุด", a: "ราคาที่เราเสนอนี้คือ **ราคาที่ดีที่สุด** ที่เราสามารถเสนอให้ได้ภายใต้ **เงื่อนไข (ระบุเงื่อนไข)** และ **การรับประกันคุณภาพ** ค่ะ ถ้าคุณพบข้อเสนอที่ดีกว่า ดิฉันยินดีที่จะพิจารณาให้คุณเป็นกรณีพิเศษค่ะ" }
    ],
    part2: [
        // Part 2: Technical & Product Information / Service Scenarios (Q31-Q60)
        { id: "P2Q31", part: 2, q: "ถ้าสินค้าพังหรือมีปัญหา ต้องทำอย่างไร?", a: "คุณลูกค้าสามารถติดต่อ **ศูนย์บริการ** ของเราได้ทันที หรือแจ้งผ่าน **Line Official** เรามีทีมช่างที่พร้อมเข้าแก้ไขปัญหาภายใน **24 ชั่วโมง** นับตั้งแต่รับแจ้งค่ะ" },
        { id: "P2Q32", part: 2, q: "สินค้านี้มีประกันกี่ปี/นานแค่ไหน?", a: "สินค้านี้มาพร้อมกับ **การรับประกันเต็มรูปแบบเป็นเวลา 1 ปี** ครอบคลุมความเสียหายที่ไม่ได้เกิดจากการใช้งานผิดประเภท และสามารถซื้อ **ประกันเพิ่ม** เป็น 3 ปีได้ค่ะ" },
        { id: "P2Q33", part: 2, q: "รุ่นนี้แตกต่างจากรุ่นก่อนหน้าอย่างไร?", a: "รุ่นใหม่นี้มีการปรับปรุงหลักๆ 3 ส่วนค่ะ คือ **1. แบตเตอรี่ใช้งานได้ยาวนานขึ้น 20%** **2. ประสิทธิภาพการประมวลผลเร็วขึ้น** และ **3. มีการเพิ่มฟีเจอร์ A** เข้ามาค่ะ" },
        { id: "P2Q34", part: 2, q: "ฉันจะรู้ได้อย่างไรว่าข้อมูลของฉันปลอดภัย?", a: "เราให้ความสำคัญกับความปลอดภัยเป็นอันดับแรกค่ะ ข้อมูลของคุณจะถูกเก็บไว้บน **เซิร์ฟเวอร์เข้ารหัสมาตรฐาน ISO 27001** และเราไม่เปิดเผยข้อมูลลูกค้าแก่บุคคลที่สามอย่างเด็ดขาดค่ะ" },
        { id: "P2Q35", part: 2, q: "การติดตั้งใช้เวลานานไหม?", a: "การติดตั้งระบบทั้งหมดใช้เวลาประมาณ **2-3 ชั่วโมง** ค่ะ โดยทีมงานของเราจะประสานงานกับคุณลูกค้า เพื่อเลือกเวลาที่สะดวกที่สุดและไม่รบกวนการทำงานของคุณค่ะ" },
        { id: "P2Q36", part: 2, q: "ถ้าฉันต้องการปรับแต่งฟีเจอร์เอง ทำได้ไหม?", a: "คุณสามารถ **ปรับแต่งฟังก์ชันพื้นฐาน** ได้เองผ่านหน้าตั้งค่าค่ะ แต่หากต้องการปรับแต่งเชิงลึก เรามี **แพ็กเกจ Custom Development** เพื่อให้ทีมงานของเราพัฒนาให้ตรงความต้องการของคุณโดยเฉพาะค่ะ" },
        { id: "P2Q37", part: 2, q: "ระบบนี้รองรับการทำงานบนมือถือไหม?", a: "รองรับค่ะ ระบบของเราทำงานได้อย่างสมบูรณ์แบบบน **แอปพลิเคชันมือถือ (iOS/Android)** ทำให้คุณสามารถตรวจสอบข้อมูลและจัดการงานได้ทุกที่ทุกเวลาค่ะ" },
        { id: "P2Q38", part: 2, q: "ช่วยแนะนำขั้นตอนการใช้งานเบื้องต้นให้หน่อย", a: "ได้เลยค่ะ ขั้นตอนง่ายๆ มี 3 ข้อคือ **1. เข้าสู่ระบบ 2. เลือกเมนู (ระบุเมนูหลัก) 3. กดบันทึก** ค่ะ หากคุณพร้อมแล้ว ดิฉันขออนุญาตเปิดหน้าจอสาธิตให้ดูเลยนะคะ" },
        { id: "P2Q39", part: 2, q: "ทำไมฉันถึงเข้าสู่ระบบไม่ได้?", a: "ต้องขออภัยในความไม่สะดวกค่ะ ไม่ทราบว่าคุณลูกค้า **เคยเปลี่ยนรหัสผ่าน** หรือ **รหัสผ่านหมดอายุ** หรือยังคะ? ขออนุญาตตรวจสอบสถานะบัญชีให้ทันทีเลยค่ะ" },
        { id: "P2Q40", part: 2, q: "สินค้าที่ฉันได้รับมีตำหนิ ควรทำอย่างไร?", a: "ดิฉันต้องขออภัยอย่างสูงในความผิดพลาดที่เกิดขึ้นค่ะ รบกวนคุณลูกค้าช่วยส่งภาพตำหนิมาให้ดิฉันตรวจสอบ พร้อมระบุ **เลขที่สั่งซื้อ** ดิฉันจะดำเนินการ **เปลี่ยนสินค้าใหม่** ให้ภายใน 3 วันทำการค่ะ" },
        { id: "P2Q41", part: 2, q: "ขอเปลี่ยนที่อยู่ในการจัดส่งได้ไหม?", a: "ได้ค่ะ รบกวนคุณลูกค้าแจ้ง **ที่อยู่ใหม่ที่ครบถ้วน** และ **เบอร์โทรศัพท์ติดต่อ** ให้ดิฉันตอนนี้เลยนะคะ หากสินค้ายังไม่ถูกจัดส่งออกจากคลัง เราสามารถเปลี่ยนแปลงให้ได้ทันทีค่ะ" },
        { id: "P2Q42", part: 2, q: "สามารถยกเลิกคำสั่งซื้อได้ภายในกี่วัน?", a: "คุณลูกค้าสามารถยกเลิกคำสั่งซื้อและรับเงินคืนเต็มจำนวนได้ภายใน **7 วัน** นับจากวันที่ชำระเงินค่ะ หากเกินจากนั้นอาจมี **ค่าธรรมเนียมการยกเลิก** เล็กน้อยค่ะ" },
        { id: "P2Q43", part: 2, q: "ฉันจะติดตามสถานะการจัดส่งได้อย่างไร?", a: "คุณลูกค้าจะได้รับ **SMS/อีเมล** พร้อม **เลขที่ติดตามพัสดุ** ภายใน 24 ชั่วโมงหลังการสั่งซื้อค่ะ และสามารถตรวจสอบสถานะได้ตลอด 24 ชั่วโมงผ่านหน้าเว็บไซต์ของเราค่ะ" },
        { id: "P2Q44", part: 2, q: "ถ้าฉันสั่งซื้อจำนวนมากจะได้ราคาพิเศษไหม?", a: "แน่นอนค่ะ หากคุณลูกค้าสั่งซื้อตั้งแต่ **10 ชิ้นขึ้นไป** เรามี **ราคาส่วนลดพิเศษสำหรับองค์กร** ให้ค่ะ รบกวนขอจำนวนที่แน่นอนเพื่อคำนวณราคาที่ดีที่สุดให้ตอนนี้เลยได้ไหมคะ?" },
        { id: "P2Q45", part: 2, q: "คุณช่วยส่งเอกสารทางเทคนิค (Specification) ให้ฉันได้ไหม?", a: "ยินดีค่ะ ดิฉันจะส่ง **เอกสารทางเทคนิค (Data Sheet)** ที่ระบุรายละเอียดทั้งหมด รวมถึง **มาตรฐานที่ได้รับการรับรอง** ให้ทางอีเมลภายใน 5 นาทีนี้เลยนะคะ" },
        { id: "P2Q46", part: 2, q: "สินค้ามีสีอื่นให้เลือกอีกไหม?", a: "มีค่ะ นอกจากสีที่เห็นในแคตตาล็อกแล้ว เรายังมี **สี (ระบุสีเพิ่มเติม)** ซึ่งเป็นรุ่นที่ได้รับความนิยมมากที่สุดในช่วงนี้ หากสนใจ ดิฉันจะส่งภาพตัวอย่างให้คุณลูกค้าพิจารณาค่ะ" },
        { id: "P2Q47", part: 2, q: "สินค้าตัวนี้มีผลกระทบต่อสิ่งแวดล้อมไหม?", a: "เราให้ความสำคัญกับสิ่งแวดล้อมค่ะ ผลิตภัณฑ์ของเราผลิตจาก **วัสดุรีไซเคิลถึง 80%** และมีกระบวนการผลิตที่เป็นมิตรต่อสิ่งแวดล้อม **ตามมาตรฐานสากล** ค่ะ" },
        { id: "P2Q48", part: 2, q: "ใช้เวลาในการผลิตนานเท่าไหร่?", a: "โดยปกติแล้ว หากเป็นสินค้าในสต็อกจะใช้เวลาจัดส่ง 1-3 วันค่ะ แต่ถ้าต้องมีการผลิตใหม่ จะใช้เวลาประมาณ **15 วันทำการ** นับจากวันที่มีการยืนยันคำสั่งซื้อนะคะ" },
        { id: "P2Q49", part: 2, q: "คุณมั่นใจได้อย่างไรว่าสินค้าจะแก้ปัญหาฉันได้จริง?", a: "ดิฉันมั่นใจค่ะ เพราะเราได้ทำการ **วิเคราะห์ปัญหาของคุณ** อย่างละเอียด และได้ปรับแต่ง **โซลูชัน A/B/C** ให้เหมาะกับสถานการณ์ของคุณโดยเฉพาะค่ะ" },
        { id: "P2Q50", part: 2, q: "ฉันต้องการคุยกับผู้จัดการ", a: "ต้องขออภัยด้วยค่ะ ไม่ทราบว่าคุณลูกค้าต้องการให้ดิฉันช่วยเหลือในเรื่องใดเป็นพิเศษคะ? ดิฉันอาจจะสามารถช่วยแก้ปัญหาได้อย่างรวดเร็วในเบื้องต้น หากไม่สามารถแก้ไขได้จริง ดิฉันจะประสานงานผู้จัดการให้ทันทีค่ะ" },
        { id: "P2Q51", part: 2, q: "ทำไมฉันถึงถูกตัดสายเมื่อกี้?", a: "ต้องขออภัยในปัญหาด้านเทคนิคที่เกิดขึ้นอย่างสูงค่ะ ไม่ทราบว่าเมื่อสักครู่เราคุยกันถึงเรื่องอะไรแล้วคะ? ดิฉันขออนุญาตสรุปและพูดต่อเพื่อให้คุณลูกค้าไม่เสียเวลานะคะ" },
        { id: "P2Q52", part: 2, q: "ฉันจ่ายเงินแล้ว แต่สถานะยังไม่เปลี่ยน", a: "ขออภัยในความผิดพลาดของระบบค่ะ รบกวนคุณลูกค้าช่วยแจ้ง **ช่องทางการชำระเงิน** และ **เวลา** ที่ชำระเงินให้ดิฉันหน่อยนะคะ ดิฉันจะรีบตรวจสอบกับฝ่ายบัญชีและปรับปรุงสถานะให้โดยเร็วที่สุดค่ะ" },
        { id: "P2Q53", part: 2, q: "มีโปรโมชั่นพิเศษสำหรับลูกค้าเก่าไหม?", a: "แน่นอนค่ะ สำหรับลูกค้าเก่าคนพิเศษเช่นคุณ เรามี **ส่วนลด 15%** สำหรับการซื้อซ้ำในครั้งถัดไป หรือ **แพ็กเกจอัปเกรด** ในราคาที่คุ้มค่ากว่าเดิมค่ะ" },
        { id: "P2Q54", part: 2, q: "ฉันต้องการเปลี่ยนแพ็กเกจตอนนี้เลย", a: "ได้ค่ะ คุณต้องการเปลี่ยนจากแพ็กเกจ **(ชื่อแพ็กเกจเดิม)** เป็น **(ชื่อแพ็กเกจใหม่)** ใช่ไหมคะ? ดิฉันจะดำเนินการอัปเกรดให้ทันที และจะส่ง **ใบยืนยันการเปลี่ยนแปลง** ให้ทางอีเมลค่ะ" },
        { id: "P2Q55", part: 2, q: "คุณให้บริการในพื้นที่/ต่างจังหวัดด้วยไหม?", a: "เราให้บริการครอบคลุม **ทั่วประเทศ** ค่ะ ไม่ว่าคุณจะอยู่ที่จังหวัดใด เรามี **เครือข่ายพันธมิตร** และ **ทีมงานติดตั้ง** ที่พร้อมเดินทางไปให้บริการคุณถึงที่ค่ะ" },
        { id: "P2Q56", part: 2, q: "ข้อมูลของฉันจะถูกสำรองไว้หรือไม่?", a: "ข้อมูลของคุณจะถูกสำรองไว้บน **ระบบ Cloud Storage** ของเราเป็นประจำทุกวันค่ะ คุณสามารถมั่นใจได้ว่าข้อมูลจะไม่สูญหายและสามารถกู้คืนได้ตลอดเวลาค่ะ" },
        { id: "P2Q57", part: 2, q: "คุณรับชำระเงินผ่านบัตรเครดิตไหม?", a: "เรารับค่ะ คุณลูกค้าสามารถชำระผ่าน **บัตรเครดิต/เดบิต ทุกธนาคาร** และเรามีบริการ **ผ่อนชำระ** สำหรับบัตรที่ร่วมรายการด้วยนะคะ" },
        { id: "P2Q58", part: 2, q: "ฉันสามารถโอนสิทธิ์การใช้งานให้คนอื่นได้ไหม?", a: "ได้ค่ะ แต่คุณจะต้องแจ้งความประสงค์อย่างเป็นทางการและกรอก **แบบฟอร์มการโอนสิทธิ์** เพื่อเปลี่ยนชื่อผู้ใช้งานในระบบของเราให้เรียบร้อยก่อนนะคะ" },
        { id: "P2Q59", part: 2, q: "ฉันมีข้อสงสัยเกี่ยวกับใบแจ้งหนี้", a: "รบกวนคุณลูกค้าช่วยแจ้ง **เลขที่ใบแจ้งหนี้** และ **วันที่** ที่ได้รับหน่อยนะคะ ดิฉันจะตรวจสอบรายละเอียดกับฝ่ายบัญชีทันทีว่ามีส่วนใดที่ผิดพลาดหรือต้องแก้ไขค่ะ" },
        { id: "P2Q60", part: 2, q: "สินค้าที่ฉันสั่งซื้อไปแล้วมีรุ่นใหม่ออกมา ทำอย่างไรดี?", a: "ไม่ต้องกังวลค่ะ สำหรับลูกค้าเก่า เรามี **ส่วนลดพิเศษ** สำหรับการแลกซื้อรุ่นใหม่ (Trade-in) ค่ะ ซึ่งจะช่วยให้คุณอัปเกรดเป็นเทคโนโลยีล่าสุดได้ในราคาที่คุ้มค่ามากค่ะ" }
    ],
    part3: [
        // Part 3: Advanced Scenarios & Soft Skills/Closing (Q61-Q90)
        { id: "P3Q61", part: 3, q: "ช่วยอธิบายขั้นตอนการคืนเงินหน่อย", a: "ขั้นตอนง่ายๆ มี 3 ข้อค่ะ **1. ส่งแบบฟอร์มขอคืนเงิน 2. รอการตรวจสอบ (3-5 วันทำการ) 3. เงินจะถูกโอนคืน** ตามช่องทางที่คุณชำระเงินมาค่ะ" },
        { id: "P3Q62", part: 3, q: "คุณสามารถรับรองได้ไหมว่าฉันจะไม่ผิดหวัง?", a: "ดิฉันไม่สามารถรับรองผลลัพธ์ 100% ได้ค่ะ แต่ดิฉันสามารถ **รับรองในคุณภาพของผลิตภัณฑ์** และ **ความมุ่งมั่นในการให้บริการ** ของเราค่ะ หากไม่พอใจเรามี **นโยบายการรับประกัน** ให้คุณมั่นใจค่ะ" },
        { id: "P3Q63", part: 3, q: "ฉันอยากยกเลิกบริการทั้งหมด", a: "ดิฉันเข้าใจค่ะ ก่อนจะดำเนินการยกเลิกทั้งหมด ขออนุญาตสอบถามว่ามี **ปัญหาใด** ที่ทำให้คุณลูกค้าไม่พึงพอใจคะ? หากเราสามารถแก้ไขได้ ดิฉันยินดีให้ความช่วยเหลือเต็มที่ค่ะ" },
        { id: "P3Q64", part: 3, q: "คุณทำแบบนี้กับลูกค้าคนอื่นด้วยไหม?", a: "แน่นอนค่ะ **มาตรฐานการให้บริการ** และ **ความจริงใจ** เป็นสิ่งที่เรามอบให้แก่ลูกค้าทุกคนอย่างเท่าเทียมกันค่ะ คุณคือคนสำคัญสำหรับเราเสมอค่ะ" },
        { id: "P3Q65", part: 3, q: "ฉันไม่ได้ร้องเรียน แค่ต้องการทราบข้อมูล", a: "ขออภัยที่เข้าใจผิดค่ะ ยินดีให้ข้อมูลเพิ่มเติมค่ะ คุณลูกค้าต้องการทราบข้อมูลเฉพาะเจาะจงเกี่ยวกับ **(ระบุหัวข้อที่ลูกค้าถามก่อนหน้า)** เพิ่มเติมอีกไหมคะ?" },
        { id: "P3Q66", part: 3, q: "ทำไมฉันถึงต้องซื้อตอนนี้ ไม่ซื้อเดือนหน้า?", a: "การซื้อตอนนี้ คุณจะได้รับ **ส่วนลดตามแคมเปญ** ที่จะหมดเขตในวันศุกร์นี้ค่ะ หากซื้อเดือนหน้า คุณอาจจะต้องจ่ายใน **ราคาเต็ม** ซึ่งจะทำให้คุณพลาดโอกาสประหยัดเงินไปหลายพันบาทเลยนะคะ" },
        { id: "P3Q67", part: 3, q: "คุณแน่ใจนะว่าเข้าใจปัญหาของฉันจริงๆ?", a: "ดิฉันเข้าใจอย่างชัดเจนค่ะ ปัญหาของคุณคือ **(สรุปปัญหาของลูกค้า)** ซึ่งเป็นปัญหาที่เรามีความเชี่ยวชาญในการแก้ไข ดิฉันขออนุญาตนำเสนอ **วิธีแก้ปัญหาที่ตรงจุด** เลยนะคะ" },
        { id: "P3Q68", part: 3, q: "คุณช่วยหาข้อมูลเกี่ยวกับ (คู่แข่ง) ให้หน่อยได้ไหม?", a: "ขออภัยค่ะ ดิฉันไม่สามารถให้ข้อมูลเกี่ยวกับคู่แข่งได้ แต่ดิฉันสามารถเน้นย้ำถึง **จุดแข็ง** และ **ความแตกต่างที่เหนือกว่า** ของผลิตภัณฑ์เรา ที่จะมอบประโยชน์สูงสุดให้กับคุณลูกค้าได้ค่ะ" },
        { id: "P3Q69", part: 3, q: "สินค้าของคุณเหมาะกับธุรกิจขนาดเล็กอย่างฉันไหม?", a: "เหมาะมากค่ะ เรามี **แพ็กเกจสำหรับธุรกิจขนาดเล็กโดยเฉพาะ** ที่มาพร้อมกับฟีเจอร์ที่จำเป็นในราคาที่จับต้องได้ เพื่อให้คุณสามารถเติบโตได้อย่างรวดเร็วค่ะ" },
        { id: "P3Q70", part: 3, q: "ฉันมีคำถามอื่นที่ไม่เกี่ยวข้องกับเรื่องนี้เลย", a: "ยินดีค่ะ ไม่ต้องกังวลนะคะ ดิฉันพร้อมตอบทุกคำถามเพื่อให้คุณลูกค้าได้รับข้อมูลที่ครบถ้วนค่ะ รบกวนคุณลูกค้าช่วยถามคำถามที่ต้องการได้เลยนะคะ" },
        { id: "P3Q71", part: 3, q: "คุณมีความคิดเห็นอย่างไรเกี่ยวกับ (ประเด็นร้อนในข่าว)?", a: "ขออภัยค่ะ ดิฉันขออนุญาตโฟกัสไปที่การให้ข้อมูลสินค้าและบริการของเราก่อนนะคะ หากคุณลูกค้ามีคำถามเกี่ยวกับผลิตภัณฑ์ ดิฉันยินดีตอบคำถามค่ะ" },
        { id: "P3Q72", part: 3, q: "คุณพูดเร็วเกินไป ฟังไม่ทัน", a: "ดิฉันต้องขออภัยอย่างสูงค่ะ ขออนุญาตพูดให้ช้าลงและชัดเจนขึ้นนะคะ ตอนนี้คุณลูกค้าอยากให้ดิฉัน **ทวน** ส่วนใดเป็นพิเศษไหมคะ?" },
        { id: "P3Q73", part: 3, q: "ฉันคุยโทรศัพท์ไม่สะดวกแล้ว ขอเป็นแชทได้ไหม?", a: "ได้ค่ะ ดิฉันจะส่งข้อมูลสรุปและช่องทางการแชท **Line Official** ให้คุณลูกค้าทันทีค่ะ รบกวนคุณลูกค้าตอบกลับในแชทเมื่อสะดวกนะคะ" },
        { id: "P3Q74", part: 3, q: "คุณมั่นใจได้ไงว่าสินค้าจะไม่ตกรุ่นในเร็วๆ นี้?", a: "เรามีการ **วิจัยและพัฒนาผลิตภัณฑ์อย่างต่อเนื่อง** ค่ะ และมีการรับประกันว่า **จะมีการอัปเดตซอฟต์แวร์** และ **การสนับสนุนด้านเทคนิค** ต่อเนื่องไปอีกอย่างน้อย 5 ปีค่ะ" },
        { id: "P3Q75", part: 3, q: "ฉันมีหลายสาขา ต้องซื้อหลายบัญชีไหม?", a: "คุณลูกค้าไม่ต้องซื้อหลายบัญชีค่ะ เรามี **แพ็กเกจสำหรับองค์กร** ที่สามารถรองรับ **หลายสาขา/หลายผู้ใช้งาน** ได้ในบัญชีเดียว ซึ่งจะช่วยให้คุณจัดการได้ง่ายขึ้นค่ะ" },
        { id: "P3Q76", part: 3, q: "ฉันขอเอกสารทั้งหมดเป็นภาษาอังกฤษได้ไหม?", a: "ได้ค่ะ เรามี **คู่มือ** และ **เอกสารทางเทคนิค** เป็นภาษาอังกฤษพร้อมให้บริการค่ะ ดิฉันจะส่งไฟล์ทั้งหมดให้คุณทางอีเมลในรูปแบบ PDF นะคะ" },
        { id: "P3Q77", part: 3, q: "ฉันจะติดต่อคุณได้อีกครั้งเมื่อไหร่?", a: "คุณลูกค้าสามารถติดต่อดิฉันได้ทุกวันทำการตั้งแต่เวลา **09:00 - 18:00 น.** ค่ะ หรือฝากข้อความไว้ได้ตลอด 24 ชั่วโมง แล้วดิฉันจะรีบติดต่อกลับไปโดยเร็วที่สุดค่ะ" },
        { id: "P3Q78", part: 3, q: "คุณทำงานที่นี่มากี่ปีแล้ว?", a: "ดิฉันทำงานที่นี่มา **(ระบุจำนวนปี)** แล้วค่ะ และมีความเชี่ยวชาญในการให้คำแนะนำเกี่ยวกับ **(ระบุประเภทสินค้า)** เป็นพิเศษค่ะ ยินดีรับใช้คุณลูกค้าค่ะ" },
        { id: "P3Q79", part: 3, q: "ทำไมถึงไม่มีเบอร์ติดต่อ Call Center โดยตรง?", a: "ต้องขออภัยในความไม่สะดวกค่ะ เพื่อให้การบริการมีประสิทธิภาพสูงสุด เราได้เปลี่ยนมาใช้ **ระบบ Support Ticket** ผ่าน Line Official หรืออีเมลค่ะ ซึ่งจะทำให้ปัญหาของคุณถูกติดตามและแก้ไขได้รวดเร็วกว่าการรอสายค่ะ" },
        { id: "P3Q80", part: 3, q: "ฉันไม่อยากให้ข้อมูลส่วนตัวกับคุณ", a: "ดิฉันเข้าใจและเคารพการตัดสินใจของคุณลูกค้าค่ะ การสนทนานี้เป็นไปตาม **นโยบายความเป็นส่วนตัว** ของบริษัทค่ะ ข้อมูลทั้งหมดจะถูกใช้เพื่อวัตถุประสงค์ในการให้บริการเท่านั้นค่ะ" },
        { id: "P3Q81", part: 3, q: "คุณช่วยรอฉัน 5 นาทีได้ไหม?", a: "ได้แน่นอนค่ะ ดิฉันจะรอสาย 5 นาทีค่ะ และจะกลับมาพูดต่อเมื่อครบกำหนดนะคะ (หากเลยเวลา 5 นาทีแล้ว) คุณลูกค้าสะดวกให้ดิฉันพูดต่อได้เลยไหมคะ?" },
        { id: "P3Q82", part: 3, q: "ฉันไม่ต้องการสมัครรับข่าวสาร/อีเมลอีกแล้ว", a: "ได้ค่ะ ดิฉันจะดำเนินการยกเลิกการรับข่าวสารจากระบบให้คุณลูกค้าทันทีค่ะ คุณจะไม่ได้รับอีเมลโปรโมชั่นจากเราอีกต่อไปนะคะ" },
        { id: "P3Q83", part: 3, q: "คุณช่วยนัดหมายการสาธิตสินค้า (Demo) ให้ฉันหน่อย", a: "ยินดีค่ะ คุณลูกค้าสะดวกให้ทีมงานของเราเข้าไปสาธิตสินค้าใน **วันและเวลา** ใดคะ? รบกวนขอ **สถานที่** หรือ **ลิงก์วิดีโอคอล** สำหรับการสาธิตด้วยค่ะ" },
        { id: "P3Q84", part: 3, q: "คุณคิดว่าอะไรคือจุดอ่อนของผลิตภัณฑ์คุณ?", a: "หากพูดถึงจุดอ่อน อาจเป็นเรื่องของ **ราคาเริ่มต้น** ที่อาจสูงกว่าคู่แข่งบ้างค่ะ แต่จุดอ่อนนี้ก็ถูกชดเชยด้วย **คุณภาพวัสดุ** และ **ฟีเจอร์ที่ครบครันกว่า** อย่างมากค่ะ" },
        { id: "P3Q85", part: 3, q: "ฉันอยากซื้อตอนนี้เลย ต้องทำอย่างไร?", a: "เยี่ยมเลยค่ะ! ดิฉันจะส่ง **ลิงก์สำหรับชำระเงิน** และ **ใบแจ้งหนี้** ให้ทางอีเมล/แชททันทีเลยนะคะ คุณลูกค้าต้องการให้ชำระผ่านช่องทางใดดีคะ **บัตรเครดิตหรือโอนเงิน**" },
        { id: "P3Q86", part: 3, q: "สามารถเปลี่ยนใจหลังจากชำระเงินได้ไหม?", a: "คุณสามารถเปลี่ยนใจได้ค่ะ หากยังอยู่ภายใน **เงื่อนไข (ระบุเงื่อนไขเช่น 7 วัน)** เรามีนโยบายให้ **เปลี่ยนรุ่น/ยกเลิก** ได้ค่ะ แต่ขอให้ตรวจสอบเงื่อนไขในใบสั่งซื้ออีกครั้งนะคะ" },
        { id: "P3Q87", part: 3, q: "คุณมีการฝึกอบรมการใช้งานให้ไหม?", a: "มีค่ะ เรามี **การฝึกอบรมแบบตัวต่อตัว** และ **วิดีโอคอร์สออนไลน์** ฟรีสำหรับลูกค้าของเรา เพื่อให้คุณและทีมงานสามารถใช้งานผลิตภัณฑ์ได้อย่างเต็มประสิทธิภาพที่สุดค่ะ" },
        { id: "P3Q88", part: 3, q: "ฉันถูกเรียกเก็บเงินซ้ำซ้อน", a: "ขออภัยในความผิดพลาดที่เกิดขึ้นค่ะ รบกวนคุณลูกค้าช่วยส่ง **หลักฐานการชำระเงินทั้งสองรายการ** ให้ดิฉันตรวจสอบทันทีนะคะ ดิฉันจะรีบดำเนินการ **คืนเงิน** ส่วนที่ซ้ำซ้อนให้ภายใน 24 ชั่วโมงค่ะ" },
        { id: "P3Q89", part: 3, q: "ช่วยแนะนำขั้นตอนการคืนสินค้าหน่อย", a: "ขั้นตอนคือ **1. กรอกแบบฟอร์มการคืนสินค้าออนไลน์ 2. แพ็กสินค้าพร้อมแนบใบเสร็จ 3. จัดส่งคืนตามที่อยู่ที่แจ้ง** เมื่อสินค้าถึงคลังและตรวจสอบแล้ว จะมีการดำเนินการคืนเงินค่ะ" },
        { id: "P3Q90", part: 3, q: "ขอให้คุณสรุปข้อเสนอทั้งหมดอีกครั้ง", a: "ได้ค่ะ ข้อเสนอของเรามี 3 ประเด็นหลักคือ **1. คุณภาพที่เหนือกว่า 2. การรับประกัน 1 ปีเต็ม** และ **3. ส่วนลด (ระบุส่วนลด) ที่มีให้เฉพาะวันนี้** ค่ะ หากมีคำถามเพิ่มเติม ดิฉันยินดีตอบค่ะ" }
    ]
};

// --- Global Variables ---
let currentPart = null;
let currentQuestionIndex = -1;
let mediaRecorder;
let recordedChunks = [];
let audioBlobs = { part1: {}, part2: {}, part3: {} }; // เก็บ Blob เสียงของทุกข้อ
const inputUserName = document.getElementById('inputUserName');
const submitBtn = document.getElementById('submitBtn');

// --- Alert & Loading Management ---
function showAlert(message, type) {
    const alertBox = document.getElementById('mainAlert');
    alertBox.textContent = message;
    alertBox.className = `alert ${type}`;
    alertBox.style.display = 'block';
}

function showLoading(show) {
    document.getElementById('loadingOverlay').style.display = show ? 'flex' : 'none';
}

// --- Supabase Functions ---

async function uploadAudioToSupabase(file, partId) {
    const fileExt = file.name.split('.').pop();
    const userName = inputUserName.value.trim().replace(/[^a-zA-Z0-9ก-๙]/g, '_'); // Clean name
    const fileName = `${userName}_${partId}_${uuidv4()}.${fileExt}`;
    const filePath = `${userName}/${fileName}`; // จัดเก็บแยก Folder ตาม User

    const { data, error } = await supabase.storage
        .from('responses') // Bucket Name
        .upload(filePath, file, {
            cacheControl: '3600',
            upsert: false // ไม่อนุญาตให้เขียนทับไฟล์เดิม
        });

    if (error) {
        console.error('Upload error:', error.message);
        throw new Error('เกิดข้อผิดพลาดในการอัปโหลดไฟล์เสียง: ' + error.message);
    }

    const { data: { publicUrl } } = supabase.storage
        .from('responses')
        .getPublicUrl(filePath);

    return publicUrl;
}

// --- ฟังก์ชันส่งคำตอบพร้อมอัปโหลดเสียง (Bulk Upload) ---
async function uploadBlobs(partBlobs) {
    showLoading(true);
    const uploadPromises = Object.entries(partBlobs).map(async ([questionId, recordedBlob]) => {
        // ต้องหา questionData จาก part ที่ถูกต้อง (currentPart)
        const partData = questions[currentPart] || [];
        const questionData = partData.find(q => q.id === questionId);
        if (!questionData) return;

        const audioFile = new File([recordedBlob], `${questionId}_response.wav`, { type: "audio/wav" });
        
        // 1. Upload file
        const publicUrl = await uploadAudioToSupabase(audioFile, questionId);

        // 2. Insert to database (submissions table)
        const { error: insertError } = await supabase
            .from('submissions')
            .insert([
                {
                    user_id: inputUserName.value.trim() || 'anonymous',
                    question_id: questionId,
                    part_no: questionData.part,
                    prompt_q: questionData.q,
                    required_a: questionData.a,
                    audio_url: publicUrl,
                    submitted_at: new Date().toISOString()
                }
            ]);

        if (insertError) {
            console.error('Database insert error:', insertError.message);
            throw new Error(`เกิดข้อผิดพลาดในการบันทึกข้อมูล ${questionId}: ${insertError.message}`);
        }
    });

    try {
        await Promise.all(uploadPromises);
    } finally {
        showLoading(false);
    }
}


// --- Media Recorder Functions ---

async function handleStartRecording() {
    if (currentQuestionIndex < 0 || !currentPart || !questions[currentPart]) {
        showAlert('กรุณาเลือก Part และข้อคำถามก่อนเริ่มบันทึกเสียง', 'warning');
        return;
    }

    if (!inputUserName.value.trim()) {
        showAlert('กรุณากรอก ชื่อ-รหัสพนักงาน ก่อนเริ่มบันทึกเสียง', 'warning');
        inputUserName.focus();
        return;
    }

    // Save User Name
    localStorage.setItem('examUserName', inputUserName.value.trim());

    try {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        mediaRecorder = new MediaRecorder(stream, { mimeType: 'audio/wav' });
        recordedChunks = [];

        mediaRecorder.ondataavailable = (event) => {
            if (event.data.size > 0) {
                recordedChunks.push(event.data);
            }
        };

        mediaRecorder.onstop = () => {
            const recordedBlob = new Blob(recordedChunks, { type: 'audio/wav' });
            const audioUrl = URL.createObjectURL(recordedBlob);
            document.getElementById('playbackAudio').src = audioUrl;

            // Save the Blob to the global storage
            const questionId = questions[currentPart][currentQuestionIndex].id;
            audioBlobs[currentPart][questionId] = recordedBlob;

            renderQuestionList(); // Update status icon
            checkSubmitButtonStatus(); // Check if all 30 are done

            // Clear stream
            stream.getTracks().forEach(track => track.stop());
            document.getElementById('recordingStatus').textContent = 'สถานะ: บันทึกสำเร็จแล้ว (สามารถฟังซ้ำได้)';
        };

        mediaRecorder.start();
        document.getElementById('recordingStatus').textContent = 'สถานะ: กำลังบันทึกเสียง... (พูดได้เลย)';
        document.getElementById('startRecBtn').disabled = true;
        document.getElementById('stopRecBtn').disabled = false;
        document.getElementById('playbackAudio').src = '';
        showAlert('', ''); // Clear alert

    } catch (err) {
        console.error('Recording Error:', err);
        showAlert('ไม่สามารถเข้าถึงไมโครโฟนได้ กรุณาตรวจสอบสิทธิ์การเข้าถึง (Microphone permission)', 'warning');
    }
}

function handleStopRecording() {
    if (mediaRecorder && mediaRecorder.state !== 'inactive') {
        mediaRecorder.stop();
        document.getElementById('startRecBtn').disabled = false;
        document.getElementById('stopRecBtn').disabled = true;
    }
}

// --- Q&A Data and Navigation ---

function renderQuestionList() {
    const listContainer = document.getElementById('questionList');
    listContainer.innerHTML = '';
    const partQuestions = questions[currentPart] || [];
    
    // ตรวจสอบสถานะปุ่มนำทาง
    document.getElementById('prevBtn').disabled = currentQuestionIndex <= 0;
    document.getElementById('nextBtn').disabled = currentQuestionIndex >= partQuestions.length - 1;


    partQuestions.forEach((q, index) => {
        const item = document.createElement('div');
        item.className = 'question-item';
        if (index === currentQuestionIndex) {
            item.classList.add('active');
        }
        item.setAttribute('data-index', index);
        item.onclick = () => selectQuestion(index);

        const statusIcon = audioBlobs[currentPart] && audioBlobs[currentPart][q.id]
            ? '<span class="status-icon" style="color:#28a745;">✓</span>' // Done
            : '<span class="status-icon" style="color:#ffc107;">•</span>'; // Pending

        item.innerHTML = `ข้อที่ ${index + 1}: ${q.q.substring(0, 30)}... ${statusIcon}`;
        listContainer.appendChild(item);
    });
    // Scroll to active item
    const activeItem = listContainer.querySelector('.question-item.active');
    if (activeItem) {
        activeItem.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }
}

function selectQuestion(index) {
    if (!currentPart || !questions[currentPart] || index < 0 || index >= questions[currentPart].length) {
        return;
    }
    
    handleStopRecording(); // Stop recording if switching question
    currentQuestionIndex = index;
    const qData = questions[currentPart][currentQuestionIndex];
    document.getElementById('currentQuestionTitle').textContent = `Part ${qData.part} | ข้อที่ ${currentQuestionIndex + 1}`;
    document.getElementById('questionPrompt').textContent = qData.q;
    document.getElementById('requiredAnswer').innerHTML = qData.a; // Use innerHTML for bold formatting

    // Clear and check playback
    document.getElementById('playbackAudio').src = '';
    document.getElementById('recordingStatus').textContent = 'สถานะ: ยังไม่ได้เริ่มบันทึกเสียง';
    document.getElementById('startRecBtn').disabled = false;
    document.getElementById('stopRecBtn').disabled = true;

    const recordedBlob = audioBlobs[currentPart] && audioBlobs[currentPart][qData.id];
    if (recordedBlob) {
        const audioUrl = URL.createObjectURL(recordedBlob);
        document.getElementById('playbackAudio').src = audioUrl;
        document.getElementById('recordingStatus').textContent = 'สถานะ: บันทึกสำเร็จแล้ว (สามารถฟังซ้ำได้)';
    }

    renderQuestionList();
}

function loadPart(partName) {
    if (currentPart === partName) return; // Already loaded
    
    currentPart = partName;
    currentQuestionIndex = -1; // Reset index
    document.getElementById('examArea').style.display = 'flex';

    // Update button style
    document.querySelectorAll('.part-button').forEach(btn => btn.classList.remove('active'));
    document.getElementById(`btnPart${currentPart.slice(-1)}`).classList.add('active');

    // Load first question in the part
    if (questions[currentPart].length > 0) {
        selectQuestion(0);
    } else {
        document.getElementById('currentQuestionTitle').textContent = `Part ${currentPart.slice(-1)} | ยังไม่มีคำถาม`;
        document.getElementById('questionPrompt').textContent = 'ไม่มีข้อมูลคำถามสำหรับ Part นี้';
        document.getElementById('requiredAnswer').textContent = '';
        renderQuestionList();
    }
    checkSubmitButtonStatus();
}

function nextQuestion() {
    if (currentPart && currentQuestionIndex < questions[currentPart].length - 1) {
        selectQuestion(currentQuestionIndex + 1);
    }
}

function prevQuestion() {
    if (currentPart && currentQuestionIndex > 0) {
        selectQuestion(currentQuestionIndex - 1);
    }
}

function checkSubmitButtonStatus() {
    if (!currentPart) {
        submitBtn.disabled = true;
        return;
    }
    const totalQuestions = questions[currentPart].length;
    const recordedCount = Object.keys(audioBlobs[currentPart] || {}).length;
    
    // Check if all questions have a recorded blob
    if (recordedCount === totalQuestions && totalQuestions > 0) {
        submitBtn.disabled = false;
        submitBtn.textContent = `ส่งคำตอบ Part ${currentPart.slice(-1)} (${recordedCount}/${totalQuestions} ข้อ)`;
    } else {
        submitBtn.disabled = true;
        submitBtn.textContent = `ส่งคำตอบ (บันทึกแล้ว ${recordedCount}/${totalQuestions} ข้อ)`;
    }
}


async function submitExam() {
    if (submitBtn.disabled || !currentPart) return;

    const recordedCount = Object.keys(audioBlobs[currentPart] || {}).length;
    const totalQuestions = questions[currentPart].length;

    if (recordedCount !== totalQuestions) {
        showAlert(`กรุณาบันทึกเสียงให้ครบทุกข้อก่อนส่งงาน (ยังขาดอีก ${totalQuestions - recordedCount} ข้อ)`, 'warning');
        return;
    }

    if (!confirm(`คุณต้องการส่งคำตอบทั้งหมด ${recordedCount} ข้อ ของ Part ${currentPart.slice(-1)} ใช่หรือไม่?`)) {
        return;
    }
    
    // Perform bulk upload and database insert
    uploadBlobs(audioBlobs[currentPart])
        .then(() => {
            showAlert('ส่งคำตอบและไฟล์เสียงสำเร็จเรียบร้อยแล้ว! ✅', 'success');
            // ล้างข้อมูล Part ที่ส่งแล้ว
            audioBlobs[currentPart] = {};
            currentPart = null; // Clear current part
            currentQuestionIndex = -1; // Reset index
            renderQuestionList(); 
            submitBtn.disabled = true;
            
            // เปลี่ยนสถานะหน้าจอเป็นหน้าเลือก Part ใหม่
            document.getElementById('examArea').style.display = 'none';
            document.getElementById('currentQuestionTitle').textContent = 'ส่งงานสำเร็จ';
            document.getElementById('questionPrompt').textContent = 'กรุณาเลือก Part อื่นเพื่อทำแบบทดสอบต่อ';
            document.getElementById('requiredAnswer').textContent = '';
            document.querySelectorAll('.part-button').forEach(btn => btn.classList.remove('active')); // Clear active button
            
        })
        .catch(error => {
            console.error('Submission Error:', error);
            showAlert('เกิดข้อผิดพลาดในการส่งข้อมูล/ไฟล์เสียง กรุณาลองใหม่อีกครั้ง', 'warning');
        });
}

// --- Initialization ---

// โหลดชื่อผู้ใช้งานจาก Local Storage
document.addEventListener('DOMContentLoaded', () => {
    const storedUserName = localStorage.getItem('examUserName');
    if (storedUserName) {
        inputUserName.value = storedUserName;
    }
    // ตรวจสอบสถานะปุ่มส่งเมื่อโหลดหน้าเว็บ
    checkSubmitButtonStatus();
});


</script>
</body>
</html>
