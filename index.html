<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>แบบทดสอบการพูดและการบันทึกเสียง (Voice HD)</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* --- Global Styles --- */
        body {
            font-family: 'Sarabun', sans-serif;
            background-color: #f4f7f6;
            margin: 0;
            padding: 0; /* ลบ padding ออกเพื่อให้ responsive ง่ายขึ้น */
            color: #333;
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 20px auto; /* เพิ่ม margin บนล่าง */
            background: #fff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }
        header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 15px;
        }
        h1 {
            color: #007bff;
            font-weight: 700;
        }
        h2 {
            color: #007bff;
            border-left: 4px solid #007bff;
            padding-left: 10px;
        }

        /* --- Input and Part Selection --- */
        .user-info, .part-selection {
            margin-bottom: 25px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        #inputUserName {
            padding: 10px;
            max-width: 300px; /* จำกัดความยาวช่องชื่อ */
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 16px;
        }
        .part-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        .part-button {
            flex: 1; /* ทำให้ปุ่มยืดได้ */
            min-width: 120px;
            padding: 12px 25px;
            font-size: 16px;
            cursor: pointer;
            border: 1px solid #007bff;
            border-radius: 6px;
            background-color: #fff;
            color: #007bff;
            transition: background-color 0.3s, color 0.3s;
        }
        .part-button:hover, .part-button.active {
            background-color: #007bff;
            color: #fff;
            box-shadow: 0 4px 8px rgba(0, 123, 255, 0.3);
        }

        /* --- Exam Area Layout (Responsive) --- */
        #examArea {
            display: grid;
            grid-template-columns: 2fr 1fr; /* 2 ส่วนสำหรับคำถาม, 1 ส่วนสำหรับรายการ */
            gap: 30px;
        }
        
        @media (max-width: 768px) {
            #examArea {
                grid-template-columns: 1fr; /* Stacked layout on mobile */
            }
            .container {
                margin: 10px;
                padding: 15px;
            }
        }
        
        /* --- Question Panel --- */
        .question-panel {
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background-color: #f9f9f9;
        }
        .question-content, .required-answer {
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
            font-size: 1.1em; /* เพิ่มขนาดตัวอักษรหลัก */
        }
        .question-content {
            background-color: #e0f7fa; /* สีอ่อนสำหรับคำถาม */
            border-left: 5px solid #00bcd4;
        }
        .required-answer {
            background-color: #ffeccf;
            border-left: 5px solid #ff9800;
        }
        
        /* --- Controls & Status --- */
        .recording-controls {
            margin-top: 25px;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        #recordingStatus {
            font-weight: 700;
            margin-top: 20px;
            font-size: 1.1em;
            color: #007bff;
        }
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            font-weight: 700;
            transition: opacity 0.2s, transform 0.2s;
            font-size: 1em;
        }
        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
        }
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .btn-danger { background-color: #dc3545; }
        .btn-success { background-color: #28a745; }
        .btn-primary { background-color: #007bff; margin-top: 20px; width: 100%;} /* ปุ่มส่ง Part ให้เต็มความกว้าง */

        #playbackControls {
            margin-top: 15px;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 15px;
            padding: 10px;
            border-top: 1px solid #eee;
        }
        #playbackAudio {
            flex-grow: 1;
            min-width: 200px;
        }
        #sendQuestionBtn {
            flex-shrink: 0;
            font-size: 1.1em;
        }

        /* --- Question List Panel --- */
        .question-list-panel {
            padding: 15px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            max-height: 600px;
            overflow-y: auto;
        }
        .question-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .question-item:hover, .question-item.active {
            background-color: #e9f7ff;
            font-weight: 700;
            border-left: 3px solid #007bff;
        }
        .status-icon {
            font-size: 1.2em;
            margin-left: 5px;
        }
        
        /* --- Alerts and Loading --- */
        .alert {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
            display: none;
            font-weight: 700;
        }
        .alert.info { background-color: #e7f7ff; color: #0056b3; border: 1px solid #b8daff; }
        .alert.success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .alert.warning { background-color: #fff3cd; color: #856404; border: 1px solid #ffeeba; }
        
        #loadingOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.85);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            flex-direction: column;
            font-size: 1.8em;
            color: #007bff;
        }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>แบบทดสอบการพูดและการบันทึกเสียง (Voice HD)</h1>
            <p>กรุณาทำแบบทดสอบให้ครบ 90 ข้อ (3 Part) โดยบันทึกเสียงทีละข้อ และกดส่งเมื่อตรวจสอบไฟล์เสียงแล้ว</p>
        </header>

        <div id="mainAlert" class="alert info"></div>

        <div class="user-info">
            <h2>1. ข้อมูลผู้เข้าสอบ</h2>
            <label for="inputUserName">ชื่อ-นามสกุล/รหัสพนักงาน:</label>
            <input type="text" id="inputUserName" onchange="saveUserName()" placeholder="กรุณากรอกชื่อ-นามสกุล/รหัสพนักงาน" required>
        </div>

        <div class="part-selection">
            <h2>2. เลือก Part ที่ต้องการทำแบบทดสอบ</h2>
            <div class="part-buttons">
                <button id="btnPart1" class="part-button" onclick="loadPart('part1')">Part 1 (30 ข้อ)</button>
                <button id="btnPart2" class="part-button" onclick="loadPart('part2')">Part 2 (30 ข้อ)</button>
                <button id="btnPart3" class="part-button" onclick="loadPart('part3')">Part 3 (30 ข้อ)</button>
            </div>
        </div>

        <div id="examArea" style="display: none;">
            <div class="question-panel">
                <h2 id="currentQuestionTitle">Part 1: คำถามข้อที่ 1</h2>
                
                <div class="question-content">
                    <p><strong>คำถาม:</strong> <span id="questionPrompt">...</span></p>
                </div>

                <div class="required-answer">
                    <p><strong>แนวทางคำตอบที่ต้องการ:</strong> <span id="requiredAnswer">...</span></p>
                </div>

                <p id="recordingStatus" style="font-weight: 700; margin-top: 20px;">สถานะ: ยังไม่ได้เริ่มบันทึกเสียง</p>

                <div class="recording-controls">
                    <button id="startRecBtn" class="btn btn-success" onclick="handleStartRecording()">เริ่มบันทึกเสียง</button>
                    <button id="stopRecBtn" class="btn btn-danger" onclick="handleStopRecording()" disabled>หยุดบันทึก</button>
                </div>

                <div id="playbackControls">
                    <audio id="playbackAudio" controls style="display: none;"></audio>
                    <button id="sendQuestionBtn" onclick="handleSingleSubmission()" class="btn btn-success" style="display: none;" disabled>
                        ส่งคำตอบข้อนี้ (บันทึกและส่ง)
                    </button>
                </div>

                <button id="submitBtn" onclick="submitExam()" class="btn btn-primary" disabled>
                    ส่งงาน Part (ส่งแล้ว 0/30 ข้อ)
                </button>
            </div>

            <div class="question-list-panel">
                <h3>รายการคำถาม</h3>
                <div id="questionList">
                    </div>
            </div>
        </div>
    </div>
    
    <div id="loadingOverlay">
        <p>กำลังดำเนินการส่งข้อมูล... กรุณารอสักครู่</p>
    </div>

    <script type="module">

        // --- Supabase Imports & Config ---
        // **กรุณาตรวจสอบ URL และ Key ของ Supabase อีกครั้งก่อนใช้งานจริง**
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

        const supabaseUrl = 'https://wzwyotzzxycqfwercakh.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Ind6d3lvdHp6eHljcWZ3ZXJjYWtoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcwNTg3MTMsImV4cCI6MjA3MjYzNDcxM30.lgiAf9oBUqsaWGb3u_80wuoKAODQHE_lIBxpGumhrno';
        const supabase = createClient(supabaseUrl, supabaseKey);

        // --- Questions Data (90 ข้อ) ---
        const questions = {
            // Part 1: การแก้คำปฏิเสธต้นสาย (30 ข้อ)
            part1: [
                { id: "P1Q1", part: 1, q: "แพงไปหน่อยนะ ลดราคาได้ไหม?",  a: "เข้าใจเลยค่ะว่ากังวลเรื่องราคา แต่สิ่งที่คุณกำลังลงทุนนี้คือ **คุณภาพ** และ **ผลลัพธ์ที่ยั่งยืน** ซึ่งเรามีบริการหลังการขายและฟีเจอร์ที่คู่แข่งไม่มี เมื่อเทียบกับมูลค่าที่คุณจะได้รับ ถือว่าคุ้มค่ามากค่ะ" },
                { id: "P1Q2", part: 1, q: "ตอนนี้ยุ่งอยู่ โทรมาใหม่ได้ไหม?",  a: "ขออนุญาตใช้เวลา **30 วินาที** สรุปสาระสำคัญที่คุณจะได้รับประโยชน์ได้ไหมคะ? หากไม่สนใจ ดิฉันจะวางสายทันทีค่ะ (รอการตอบรับ) ขอบคุณค่ะ สิ่งนี้จะช่วยคุณ..." },
                { id: "P1Q3", part: 1, q: "ขอปรึกษาคนในครอบครัว/หัวหน้าก่อนนะ",  a: "เป็นเรื่องที่ดีเลยค่ะที่ปรึกษาผู้มีส่วนเกี่ยวข้อง ดิฉันขออนุญาตสรุปจุดเด่น 3 ข้อ เพื่อให้คุณนำไปนำเสนอได้ง่ายขึ้นนะคะ? มีอะไรที่ต้องชี้แจงเพิ่มเติมไหมคะ?" },
                { id: "P1Q4", part: 1, q: "ไม่สนใจสินค้าประเภทนี้เลย",  a: "ดิฉันเข้าใจค่ะ แต่ผลิตภัณฑ์นี้ถูกออกแบบมาเพื่อช่วย **แก้ปัญหา A, B, C** ซึ่งหลายคนก็คิดว่าไม่สนใจ จนกระทั่งได้ลองฟัง... ขออนุญาตแนะนำสิ่งที่จะช่วยประหยัดเวลา/เงินให้คุณ 5 นาทีนะคะ?" },
                { id: "P1Q5", part: 1, q: "ฉันเคยใช้บริการแบบนี้แล้ว ไม่เห็นผล",  a: "ขออภัยที่ประสบการณ์เดิมไม่ดีค่ะ ดิฉันเข้าใจความรู้สึกของคุณเลย แต่ของเรามีการปรับปรุงในส่วนของ **'กระบวนการทำงาน/วัตถุดิบ/เทคโนโลยี'** ทำให้มั่นใจว่าคุณจะเห็นผลที่แตกต่างแน่นอนค่ะ" },
                { id: "P1Q6", part: 1, q: "ไม่มีงบประมาณสำหรับสิ่งนี้",  a: "ดิฉันเข้าใจเรื่องงบประมาณค่ะ แต่เมื่อเทียบกับ **ประโยชน์ (Value) หรือผลตอบแทน (ROI)** ที่คุณจะได้รับภายใน 3 เดือนข้างหน้าแล้ว จะพบว่านี่คือการลงทุนที่คุ้มค่าที่สุด เรามีทางเลือกให้ผ่อนชำระได้ด้วยนะคะ" },
                { id: "P1Q7", part: 1, q: "ฉันซื้อจากเจ้าอื่นไปแล้ว",  a: "ยินดีด้วยค่ะ! ถือเป็นการตัดสินใจที่ดีเยี่ยมเลย ขออนุญาตสอบถามเผื่อเป็นทางเลือกสำรองได้ไหมคะ? ในกรณีที่คุณต้องการขยายหรือหา **ทางเลือกที่มีความยืดหยุ่นกว่า** ในอนาคต" },
                { id: "P1Q8", part: 1, q: "ฉันไม่ว่างคุยนะ",  a: "ขออภัยที่รบกวนค่ะ เข้าใจว่าคุณลูกค้ามีงานสำคัญที่ต้องจัดการ ถ้าเช่นนั้น สะดวกให้ดิฉันโทรกลับกี่โมงดีคะ? หรือพรุ่งนี้ช่วงเช้าดีกว่าคะ?" },
                { id: "P1Q9", part: 1, q: "ขอส่งข้อมูลทางอีเมลมาให้ดูก่อน",  a: "ดิฉันยินดีส่งข้อมูลให้ค่ะ แต่ขออนุญาตอธิบายสั้นๆ เพียง 2 นาที เพื่อให้คุณเห็นภาพรวมและ **เลือกไฟล์ที่เกี่ยวข้อง** กับความต้องการของคุณได้ถูก จะช่วยประหยัดเวลาคุณได้มากเลยค่ะ" },
                { id: "P1Q10", part: 1, q: "ฉันไม่เชื่อว่าผลิตภัณฑ์คุณจะดีจริง",  a: "ดิฉันเข้าใจค่ะ การเชื่อในสิ่งที่ยังไม่เห็นเป็นเรื่องยาก แต่เรามี **การรับประกันคืนเงิน** ภายใน 30 วัน หรือผลลัพธ์จากลูกค้า (Testimonials) ที่มีปัญหาคล้ายคุณให้ดูค่ะ ขออนุญาตส่งข้อมูลการันตีให้ดูนะคะ" },
                { id: "P1Q11", part: 1, q: "นานเกินไป เสียเวลา",  a: "ขออภัยค่ะ ดิฉันจะตัดเข้าประเด็นสำคัญที่เกี่ยวกับคุณลูกค้าทันทีเลยนะคะ (ลดความเร็วในการพูด) สิ่งที่เราจะเสนอนี้จะช่วยให้คุณ **ประหยัดเวลา/เงิน ได้ X%** นี่คือสิ่งที่คุณมองหาใช่ไหมคะ?" },
                { id: "P1Q12", part: 1, q: "ไม่มีความจำเป็นต้องใช้",  a: "ถ้าเช่นนั้น ขออนุญาตแนะนำสิ่งที่อาจจะช่วยให้คุณ **ป้องกันปัญหา** ที่อาจเกิดขึ้นในอนาคต เช่น (ยกตัวอย่างปัญหา) เราไม่ได้ขายสิ่งที่จำเป็นวันนี้ แต่ขายสิ่งที่จำเป็นในวันหน้าค่ะ" },
                { id: "P1Q13", part: 1, q: "ไม่ตอบคำถาม (เงียบไป)",  a: "คุณลูกค้ายังอยู่กับดิฉันไหมคะ? (รอ 5 วินาที) ขออนุญาตสรุปประเด็นที่เราคุยกันได้ไหมคะว่า **ข้อเสนอของเราช่วยคุณได้อย่างไร?**" },
                { id: "P1Q14", part: 1, q: "ฉันจะติดต่อกลับไปเอง",  a: "ขอบคุณค่ะ เพื่อความรวดเร็ว ดิฉันขอชื่อและเบอร์ติดต่อที่สะดวกของคุณลูกค้าไว้ก่อนนะคะ และดิฉันจะส่งสรุปข้อมูลให้ทางอีเมล วันจันทร์หน้าเวลา 10 โมงสะดวกโทรกลับมาหาดิฉันไหมคะ?" },
                { id: "P1Q15", part: 1, q: "ฉันไม่มีอำนาจตัดสินใจ",  a: "เข้าใจค่ะ ถ้าเช่นนั้น ท่านใดมีอำนาจตัดสินใจในเรื่องนี้คะ? หรือดิฉันสามารถขอเบอร์ติดต่อของท่านนั้น และส่งข้อมูลสรุปให้คุณลูกค้าช่วยนำเสนอต่อได้ไหมคะ?" },
                { id: "P1Q16", part: 1, q: "ฉันใช้บริการฟรีอยู่แล้ว",  a: "แน่นอนค่ะ แต่บริการของเรามีฟีเจอร์/ข้อดีที่ต่างจากบริการฟรีตรงที่ **'ไม่มีข้อจำกัดด้าน... และมีบริการสนับสนุน 24 ชั่วโมง'** ซึ่งเป็นสิ่งที่บริการฟรีไม่มีค่ะ" },
                { id: "P1Q17", part: 1, q: "ตลาดกำลังไม่ดี ไม่ควรลงทุนเพิ่ม",  a: "ดิฉันเห็นด้วยค่ะว่าตลาดอาจไม่ดี แต่การลงทุนในเครื่องมือ/บริการของเราตอนนี้ คือโอกาสที่ดีที่สุดในการ **สร้างความได้เปรียบ** เหนือคู่แข่งที่กำลังชะลอตัวลงค่ะ" },
                { id: "P1Q18", part: 1, q: "ต้องใช้เวลานานในการติดตั้ง/เริ่มต้น",  a: "ผลิตภัณฑ์ของเราถูกออกแบบให้ติดตั้งง่ายและรวดเร็ว **ใช้เวลาเพียง 15 นาที** เท่านั้น และเรามีทีมงานที่พร้อมช่วยเหลือคุณตลอดกระบวนการ ไม่ต้องกังวลเรื่องนี้เลยค่ะ" },
                { id: "P1Q19", part: 1, q: "ฉันไม่อยากให้ข้อมูลส่วนตัว",  a: "ดิฉันเข้าใจค่ะ เราใช้ข้อมูลเพื่อ **'ดำเนินการตามสัญญาและปรับปรุงบริการ'** เท่านั้น และเป็นไปตามนโยบายความเป็นส่วนตัวที่เข้มงวด คุณมั่นใจได้เลยว่าข้อมูลของคุณปลอดภัย 100% ค่ะ" },
                { id: "P1Q20", part: 1, q: "โทรผิดเบอร์แล้ว",  a: "ขออภัยค่ะ เบอร์นี้เป็นเบอร์ของคุณ **'ชื่อลูกค้า'** ใช่ไหมคะ? ถ้าไม่ใช่ ดิฉันขออภัยอย่างสูงที่รบกวนเวลาอันมีค่าของคุณค่ะ" },
                { id: "P1Q21", part: 1, q: "คุณพูดเร็วไป ฟังไม่ทัน",  a: "ขออภัยค่ะ ดิฉันจะพูดช้าลงนะคะ มีส่วนไหนที่ต้องการให้ทวนคะ? หรือคุณลูกค้าสนใจในประเด็น **'A' หรือ 'B'** มากกว่ากันคะ?" },
                { id: "P1Q22", part: 1, q: "คุณเป็นใคร มาจากไหน?",  a: "ดิฉันชื่อ... จากบริษัท... ค่ะ เราติดต่อคุณเนื่องจากเราเห็นว่าคุณมีการใช้ **'บริการ X'** อยู่ และผลิตภัณฑ์ของเราสามารถช่วยคุณในเรื่อง **'Y'** ได้ค่ะ" },
                { id: "P1Q23", part: 1, q: "ผลิตภัณฑ์ของคุณซับซ้อนเกินไป",  a: "ดิฉันเข้าใจค่ะ แม้ฟังก์ชันจะเยอะ แต่การใช้งานพื้นฐาน **ง่ายกว่าที่คุณคิดมาก** เรามีทีมสนับสนุนที่พร้อมช่วยเหลือในการตั้งค่าเริ่มต้น คุณแค่ใช้งานส่วนที่คุณต้องการเท่านั้นค่ะ" },
                { id: "P1Q24", part: 1, q: "ฉันกำลังจะเปลี่ยนไปใช้บริการของคู่แข่ง",  a: "ขออนุญาตทราบเหตุผลได้ไหมคะ? บางทีเราอาจมี **ทางออกที่ดีกว่า** ในเรื่องนั้น หรือสามารถปรับปรุงบริการเพื่อรักษาคุณลูกค้าไว้ได้ค่ะ" },
                { id: "P1Q25", part: 1, q: "ฉันไม่ได้รับอีเมลที่บอกว่าจะส่งมา",  a: "ขออภัยค่ะ รบกวนคุณลูกค้าเช็คใน **Junk Mail (เมลขยะ)** ได้ไหมคะ? หรือดิฉันขออีเมลสำรองเพื่อส่งซ้ำให้ทันทีเลยค่ะ" },
                { id: "P1Q26", part: 1, q: "เราไม่มีปัญหาอะไรที่ต้องแก้ไข",  a: "เป็นเรื่องที่ดีค่ะ แต่เรามีวิธีที่จะช่วยให้คุณ **ดียิ่งขึ้นไปอีก 10%** ในเรื่อง 'ประสิทธิภาพ' หรือ 'การประหยัดต้นทุน' ซึ่งเป็นเรื่องที่คนไม่คิดว่าเป็นปัญหาจนกว่าจะลองใช้ค่ะ" },
                { id: "P1Q27", part: 1, q: "ฉันต้องการรับประกันผลลัพธ์ 100%",  a: "ดิฉันไม่สามารถรับประกัน 100% ได้ค่ะ เพราะขึ้นอยู่กับการใช้งานของคุณลูกค้าด้วย แต่เรามี **สถิติที่แสดงว่า 95%** ของลูกค้าที่ทำตามขั้นตอนของเราประสบความสำเร็จ และเราพร้อมให้คำปรึกษาตลอดการใช้งานค่ะ" },
                { id: "P1Q28", part: 1, q: "ฉันยังไม่เห็นความคุ้มค่า",  a: "เพื่อให้คุณเห็นภาพชัดเจน ขออนุญาตเทียบต้นทุน $X ต่อเดือน กับ **ผลตอบแทน** เช่น 'ประหยัดเวลา 10 ชั่วโมง/เดือน' หรือ 'เพิ่มยอดขาย $Y' ให้ดูนะคะ ถ้าทำได้ตามนี้ ถือว่าคุ้มค่าไหมคะ?" },
                { id: "P1Q29", part: 1, q: "ต้องทำสัญญาผูกมัดนานแค่ไหน?",  a: "เรามีแพ็กเกจที่หลากหลายค่ะ ทั้งแบบ **รายเดือนที่ยืดหยุ่น** และแบบ **รายปีที่ประหยัด** กว่า ถ้าคุณลูกค้าลองใช้ 3 เดือนแล้วไม่พอใจ ก็สามารถยกเลิกได้ค่ะ" },
                { id: "P1Q30", part: 1, q: "มีรีวิวจากลูกค้าคนอื่นไหม?",  a: "แน่นอนค่ะ เรามีรีวิวและ **กรณีศึกษา (Case Study)** จากลูกค้าในอุตสาหกรรมเดียวกับคุณลูกค้าเลยค่ะ ขออนุญาตส่งลิงก์วิดีโอ/บทสัมภาษณ์ให้ดูหลังจบสายได้ไหมคะ?" }
            ],
            // Part 2: การตอบคำถามไขข้อกังวลใจของลูกค้า (30 ข้อ)
            part2: [
                { id: "P2Q31", part: 2, q: "คู่แข่งของคุณทำได้ถูกกว่า",  a: "จริงค่ะ แต่เมื่อเทียบกับ **ฟีเจอร์ A, B, C** และ **บริการหลังการขาย** ของเราแล้ว ซึ่งคู่แข่งไม่มี ราคาของเราจึงเหมาะสมกับคุณภาพที่เหนือกว่า คุณภาพที่ยั่งยืนสำคัญกว่าราคาที่ถูกกว่าจริงไหมคะ?" },
                { id: "P2Q32", part: 2, q: "ฉันต้องใช้เวลาศึกษาผลิตภัณฑ์นี้ก่อน",  a: "ดิฉันเข้าใจค่ะ ขออนุญาตส่งคู่มือสั้น ๆ **ฉบับสรุป 3 หน้า** ให้คุณอ่านได้ไหมคะ? และจะนัดคุยสั้น ๆ อีกครั้งในวันพุธเพื่อตอบคำถามที่คุณสงสัยโดยเฉพาะค่ะ" },
                { id: "P2Q33", part: 2, q: "ฉันมีคู่ค้าอยู่แล้ว",  a: "ยินดีด้วยค่ะ! ถ้าเช่นนั้นคุณลูกค้าคงทราบดีว่าตลาดมีการเปลี่ยนแปลงตลอดเวลา การมี **ทางเลือกสำรอง (Backup Plan)** ที่ดีกว่าย่อมดีกว่าเสมอ เรามาดูข้อดีที่แตกต่างกันไหมคะ?" },
                { id: "P2Q34", part: 2, q: "คุณพูดจาไม่น่าเชื่อถือเลย",  a: "ขออภัยหากดิฉันทำให้รู้สึกไม่ดีค่ะ ดิฉันจะปรับปรุงการสื่อสารให้ชัดเจนและเป็นทางการมากขึ้นนะคะ เพื่อให้คุณลูกค้าเกิดความมั่นใจในข้อมูลค่ะ" },
                { id: "P2Q35", part: 2, q: "โทรศัพท์ของคุณสัญญาณไม่ดี",  a: "ขออภัยค่ะ (วางสายแล้วโทรกลับ/ย้ายตำแหน่ง) สัญญาณดีขึ้นแล้วใช่ไหมคะ? ดิฉันขอสรุปเรื่อง **'โปรโมชั่นพิเศษ'** ที่เราคุยค้างไว้เลยนะคะ" },
                { id: "P2Q36", part: 2, q: "ฉันเกรงว่าคุณจะโทรมาบ่อยเกินไป",  a: "ดิฉันขอรับปากว่าจะไม่รบกวนบ่อยค่ะ เราจะติดต่อไปเฉพาะเวลาที่มี **ข้อมูลสำคัญหรือโปรโมชั่น** ที่เป็นประโยชน์ต่อคุณลูกค้าเท่านั้นค่ะ ขออนุญาตสรุปวันนี้ให้จบนะคะ" },
                { id: "P2Q37", part: 2, q: "ฉันจะจัดการเองได้ ไม่ต้องใช้คุณ",  a: "คุณลูกค้าเก่งมากค่ะ! แต่ถ้ามี **เครื่องมือช่วยลดขั้นตอน** การทำงานที่ใช้เวลา 5 ชั่วโมงต่อสัปดาห์ ให้เหลือแค่ 10 นาที จะประหยัดเวลาและพลังงานไปทำอย่างอื่นได้มากขึ้นจริงไหมคะ?" },
                { id: "P2Q38", part: 2, q: "ฉันต้องใช้เวลานานในการย้ายข้อมูล",  a: "เรามีทีมงานเฉพาะทางที่ช่วยจัดการเรื่องการย้ายข้อมูล **ให้ฟรี** และดูแลคุณตลอดกระบวนการค่ะ คุณลูกค้าแค่ให้ข้อมูลเริ่มต้น นอกนั้นเราจัดการให้ทั้งหมดเลยค่ะ" },
                { id: "P2Q39", part: 2, q: "ฉันไม่เข้าใจว่ามันทำงานอย่างไร",  a: "ขออนุญาตอธิบายด้วยภาษาที่เข้าใจง่ายที่สุดนะคะ (ใช้ Analogies) ผลิตภัณฑ์ของเราทำงานเหมือน **'เครื่องมือ X ที่มีประโยชน์ในชีวิตประจำวัน'** โดยจะช่วยคุณ..." },
                { id: "P2Q40", part: 2, q: "มีค่าธรรมเนียมแอบแฝงไหม?",  a: "ไม่มีค่าธรรมเนียมแอบแฝงค่ะ ทุกอย่างระบุในสัญญาและ **ใบเสนอราคาอย่างชัดเจน** เรายึดมั่นในความโปร่งใสค่ะ คุณลูกค้าสามารถอ่านรายละเอียดได้ทุกบรรทัดเลยนะคะ" },
                { id: "P2Q41", part: 2, q: "ฉันกำลังจะลาออก/เปลี่ยนงาน",  a: "ยินดีด้วยค่ะ! ถ้าเช่นนั้น ใครจะมารับผิดชอบต่อจากคุณคะ? ดิฉันสามารถส่งข้อมูลทั้งหมดให้กับผู้รับผิดชอบใหม่ เพื่อให้งานของคุณดำเนินไปอย่างราบรื่นที่สุดได้ไหมคะ?" },
                { id: "P2Q42", part: 2, q: "ฉันกำลังยุ่งอยู่กับโครงการอื่น",  a: "เข้าใจค่ะ งั้นเราจะเตรียมข้อมูลสำคัญที่สุดและสั้นที่สุดให้คุณพร้อม เมื่อคุณว่างแค่ 10 นาที ก็สามารถอ่านและตัดสินใจได้ทันที **โครงการนี้ช่วยประหยัดเวลา** ให้กับคุณในระยะยาวค่ะ" },
                { id: "P2Q43", part: 2, q: "ฉันได้รับข้อเสนอที่ดีกว่า",  a: "ดีเลยค่ะ ข้อเสนอของเขาเป็นอย่างไรบ้างคะ? เพื่อให้เราได้เรียนรู้และ **ปรับปรุงข้อเสนอของเรา** ให้ดียิ่งขึ้นไปอีก เราพร้อมที่จะแข่งขันเพื่อให้คุณได้สิ่งที่ดีที่สุดค่ะ" },
                { id: "P2Q44", part: 2, q: "ฉันต้องการทดลองใช้ฟรีก่อน",  a: "เรามีแพ็กเกจทดลองใช้แบบจำกัดฟีเจอร์ให้คุณ **ใช้ได้ 7 วัน** ค่ะ แต่ถ้าต้องการทดลองใช้ฟีเจอร์เต็มรูปแบบ ต้องเป็นการสมัครแบบรายเดือนไปก่อนค่ะ" },
                { id: "P2Q45", part: 2, q: "ทำไมคุณถึงโทรหาฉัน?",  a: "เราเห็นว่าคุณมีการเข้าชมเว็บไซต์ของเราในส่วนของ **'ผลิตภัณฑ์ A'** ค่ะ จึงคิดว่าคุณกำลังมองหาทางแก้ไขปัญหาอยู่ และเรามีทางแก้ไขที่ตรงกับความต้องการของคุณค่ะ" },
                { id: "P2Q46", part: 2, q: "ผลิตภัณฑ์ของคุณไม่เหมาะกับธุรกิจขนาดเล็ก/ใหญ่",  a: "ผลิตภัณฑ์ของเรายืดหยุ่นมากค่ะ สามารถ **ปรับขนาด (Scalable)** ให้เข้ากับธุรกิจตั้งแต่ขนาดเล็กไปจนถึงองค์กรขนาดใหญ่ได้ เพียงเลือกแพ็กเกจที่เหมาะสมกับจำนวนผู้ใช้เท่านั้นค่ะ" },
                { id: "P2Q47", part: 2, q: "ฉันไม่มีเวลามาฝึกอบรม",  a: "ไม่ต้องกังวลค่ะ ผลิตภัณฑ์ใช้งานง่ายมาก และเรามี **วิดีโอสอนสั้น ๆ** ที่ใช้เวลาเรียนรู้รวมกันไม่เกิน 1 ชั่วโมง คุณสามารถเริ่มใช้งานได้ทันทีหลังติดตั้งเสร็จเลยค่ะ" },
                { id: "P2Q48", part: 2, q: "คุณมีบริการหลังการขายดีแค่ไหน?",  a: "เรามีทีมสนับสนุนตลอด **24 ชั่วโมง/7 วัน** ผ่านช่องทางโทรศัพท์ อีเมล และ Chat Support ค่ะ ลูกค้าของเราทุกคนจะได้รับผู้จัดการบัญชี (Account Manager) ส่วนตัวด้วยค่ะ" },
                { id: "P2Q49", part: 2, q: "ฉันไม่เคยได้ยินชื่อบริษัทคุณเลย",  a: "เข้าใจค่ะ เราเป็นบริษัทที่ก่อตั้งเมื่อ... และเชี่ยวชาญด้าน... ลูกค้าส่วนใหญ่ของเรามาจาก **การแนะนำแบบปากต่อปาก** ค่ะ นั่นเป็นเหตุผลที่ทำให้คุณอาจไม่คุ้นชื่อแต่คุณภาพดีแน่นอนค่ะ" },
                { id: "P2Q50", part: 2, q: "ฉันไม่สามารถยกเลิกสัญญาได้ตอนนี้",  a: "ดิฉันเข้าใจค่ะ ถ้าเช่นนั้น เรามาดูว่าเราจะเริ่มเมื่อสัญญาเดิมของคุณลูกค้าหมดอายุลงได้ไหมคะ? เราสามารถ **จองโปรโมชั่น** นี้ไว้ให้คุณล่วงหน้าได้ค่ะ" },
                { id: "P2Q51", part: 2, q: "สินค้าของคุณยังไม่สมบูรณ์แบบ",  a: "ขอบคุณสำหรับข้อเสนอแนะค่ะ เรากำลังพัฒนาเวอร์ชันถัดไปอย่างต่อเนื่อง แต่ฟังก์ชันปัจจุบัน **สามารถแก้ไขปัญหาหลัก 80%** ของคุณลูกค้าได้แล้ว เรามาเริ่มจากตรงนั้นก่อนดีไหมคะ?" },
                { id: "P2Q52", part: 2, q: "ฉันเชื่อว่าราคาจะลดลงในภายหลัง",  a: "เป็นไปได้ค่ะ แต่ตอนนี้เป็นช่วงที่ดีที่สุด เพราะเรามี **โปรโมชั่นพิเศษ X%** ที่ไม่เคยมีมาก่อน และโปรโมชั่นนี้จะหมดอายุภายใน 48 ชั่วโมงค่ะ" },
                { id: "P2Q53", part: 2, q: "คู่แข่งของฉันใช้ผลิตภัณฑ์ของคุณอยู่",  a: "นั่นแสดงว่าผลิตภัณฑ์ของเราได้ผลจริงค่ะ! ลองนึกภาพว่าถ้าคู่แข่งของคุณสามารถทำได้ดีกว่านี้เมื่อมีผลิตภัณฑ์ของเรา คุณก็ควรมี **เครื่องมือที่ดีที่สุด** เพื่อแข่งขันเช่นกันจริงไหมคะ?" },
                { id: "P2Q54", part: 2, q: "ฉันชอบความเรียบง่าย ไม่ชอบความซับซ้อน",  a: "ผลิตภัณฑ์เราเรียบง่ายมากค่ะ ฟีเจอร์ที่ซับซ้อนเราจัดการให้หมดในส่วนของ Back-end ส่วนหน้าจอที่คุณใช้ **ถูกออกแบบให้ Minimal** และใช้งานง่ายที่สุดค่ะ" },
                { id: "P2Q55", part: 2, q: "ฉันไม่ไว้ใจการซื้อขายออนไลน์",  a: "เราเข้าใจค่ะ คุณสามารถมาทำสัญญาและชำระเงิน **ที่สำนักงานของเราได้นะคะ** หรือจะใช้วิธีเก็บเงินปลายทางในการจัดส่งสินค้าก็ได้ค่ะ" },
                { id: "P2Q56", part: 2, q: "ฉันอยากให้คุณลดราคากว่านี้อีกนิด",  a: "ราคาที่เสนอนี้คือราคาที่ดีที่สุดแล้วค่ะ แต่ดิฉันสามารถเพิ่ม **สิทธิพิเศษ** เช่น 'การฝึกอบรมฟรี' หรือ 'การเข้าถึงฟีเจอร์ Pro 1 เดือน' ให้แทนได้ค่ะ" },
                { id: "P2Q57", part: 2, q: "ฉันต้องการหลักฐานทางวิทยาศาสตร์",  a: "เรามีการศึกษาและงานวิจัยรองรับค่ะ โดยเฉพาะเรื่อง **ประสิทธิภาพในการลด/เพิ่ม...** ขออนุญาตส่งข้อมูลทางเทคนิคที่ผ่านการตรวจสอบจาก (สถาบันที่เชื่อถือได้) ให้คุณลูกค้าตรวจสอบได้ไหมคะ?" },
                { id: "P2Q58", part: 2, q: "ฉันไม่เคยมีปัญหาแบบที่คุณกล่าวมา",  a: "ดีใจด้วยค่ะ แต่อย่าลืมว่า **การป้องกันย่อมดีกว่าการแก้ไข** เสมอ หากมีปัญหานั้นเกิดขึ้นมา คุณลูกค้าจะมีเครื่องมือที่พร้อมรับมือทันที จะได้ไม่ต้องเสียเวลาแก้ไขทีหลังค่ะ" },
                { id: "P2Q59", part: 2, q: "ฉันต้องการให้คุณเสนอสิ่งที่ไม่เหมือนใคร",  a: "จุดเด่นของเราคือ **'เทคโนโลยี AI ที่ปรับให้เข้ากับพฤติกรรมลูกค้าของคุณโดยเฉพาะ'** ซึ่งไม่มีในคู่แข่งรายอื่น ๆ ค่ะ สิ่งนี้คือความแตกต่างและไม่เหมือนใครที่เรามอบให้ค่ะ" },
                { id: "P2Q60", part: 2, q: "ฉันต้องการให้คุณโทรหาผู้จัดการของฉันแทน",  a: "ดิฉันยินดีค่ะ รบกวนขอชื่อและเบอร์โทรศัพท์ของผู้จัดการหน่อยนะคะ เพื่อให้ดิฉันแจ้งรายละเอียด **การเสนอราคาสุดพิเศษ** นี้ให้ท่านทราบโดยเร็วที่สุดค่ะ" }
            ],
            // Part 3: การแก้ข้อโต้แย้งหรือการโน้มน้าวระหว่างปิดการขาย (30 ข้อ)
            part3: [
                { id: "P3Q61", part: 3, q: "ฉันไม่ต้องการพูดกับพนักงานขาย",  a: "ดิฉันเข้าใจค่ะ แต่ดิฉันไม่ได้แค่ขาย ดิฉันมาเพื่อหา **ทางออกที่ดีที่สุด** ให้กับปัญหาที่คุณกำลังเผชิญอยู่ ขออนุญาตถามคำถามสั้นๆ 2 ข้อ เพื่อประเมินความต้องการของคุณลูกค้าได้ไหมคะ?" },
                { id: "P3Q62", part: 3, q: "ฉันสามารถหาผลิตภัณฑ์ที่คล้ายกันได้ในราคาถูกกว่า",  a: "อาจจะจริงค่ะ แต่ถ้าเทียบฟังก์ชันการทำงานแบบ **ต่อแบบ** จะพบว่าผลิตภัณฑ์ที่ถูกกว่านั้น **ขาดฟีเจอร์สำคัญ A, B** ไปค่ะ ซึ่งฟีเจอร์นี้เองที่จะช่วยให้คุณประหยัดเงินในระยะยาว" },
                { id: "P3Q63", part: 3, q: "เราไม่มีความจำเป็นต้องเปลี่ยนซัพพลายเออร์ตอนนี้",  a: "ดิฉันเข้าใจความภักดีค่ะ แต่การมีทางเลือกที่ดีกว่าย่อมดีกว่าเสมอ เราไม่ได้ต้องการให้คุณเปลี่ยนทันที แต่ลองเปรียบเทียบดูว่า **มีจุดไหนที่เราเหนือกว่า** ที่จะช่วยคุณในเรื่อง 'ความน่าเชื่อถือ' ได้ดีกว่าไหมคะ?" },
                { id: "P3Q64", part: 3, q: "ฉันไม่มีบัตรเครดิต/วิธีการชำระเงินไม่สะดวก",  a: "เรามีทางเลือกในการชำระเงินอื่น ๆ เช่น **โอนเงินผ่านบัญชีธนาคาร** หรือ **QR Code** ค่ะ เรายินดีอำนวยความสะดวกในช่องทางที่คุณลูกค้าสะดวกที่สุดเลยค่ะ" },
                { id: "P3Q65", part: 3, q: "ฉันต้องการดูตัวอย่างสินค้าจริงก่อน",  a: "เรามีวิดีโอ **สาธิตการใช้งาน (Demo)** ออนไลน์ให้ชมค่ะ หรือสามารถนัดหมายให้ทีมงานเข้าไปสาธิตแบบตัวต่อตัวได้ในวันพุธหน้า สะดวกไหมคะ?" },
                { id: "P3Q66", part: 3, q: "ขอคุยเฉพาะเรื่องธุรกิจ ไม่คุยเรื่องส่วนตัว",  a: "ขออภัยค่ะ ดิฉันจะเข้าเรื่องทันทีนะคะ และจะไม่รบกวนเวลาของคุณลูกค้าอีกค่ะ เพื่อเป็นการตอบแทน ดิฉันขออนุญาตให้ **ส่วนลดพิเศษ 5%** สำหรับการสั่งซื้อวันนี้เลยค่ะ" },
                { id: "P3Q67", part: 3, q: "ฉันกังวลเรื่องความปลอดภัยของข้อมูล",  a: "ระบบของเราเข้ารหัสข้อมูลระดับสูงสุดด้วย **มาตรฐาน ISO 27001** ค่ะ และเราไม่เคยมีประวัติข้อมูลรั่วไหลเลย คุณมั่นใจได้เลยว่าข้อมูลของคุณปลอดภัยเทียบเท่าธนาคารค่ะ" },
                { id: "P3Q68", part: 3, q: "บริษัทของคุณจะล้มละลายไหม?",  a: "เราเป็นบริษัทที่มีความมั่นคงทางการเงินสูง/ได้รับทุนจาก **(ชื่อนักลงทุน/สถาบันการเงิน)** และมีแผนธุรกิจในระยะยาวถึง 5 ปีค่ะ เราจะอยู่เคียงข้างคุณไปอีกนานแน่นอนค่ะ" },
                { id: "P3Q69", part: 3, q: "ขอเอกสารสรุปเป็นภาษาไทย",  a: "แน่นอนค่ะ เอกสารทั้งหมดของเราเป็น **ภาษาไทยที่สมบูรณ์** และได้รับการแปลอย่างถูกต้องตามกฎหมายค่ะ ดิฉันจะส่งให้ทางอีเมลภายใน 5 นาทีหลังจบสายค่ะ" },
                { id: "P3Q70", part: 3, q: "ฉันไม่สามารถตัดสินใจภายในวันนี้",  a: "ดิฉันเข้าใจค่ะ แต่ข้อเสนอนี้เป็นราคาพิเศษสำหรับ **ลูกค้า 100 ท่านแรก** เท่านั้น ซึ่งจะหมดอายุภายในวันนี้ ถ้าคุณลูกค้าสนใจจริงๆ ดิฉันขออนุญาตจองสิทธิ์นี้ไว้ให้ได้ไหมคะ?" },
                { id: "P3Q71", part: 3, q: "มีค่าใช้จ่ายเพิ่มเติมในการอัพเกรดไหม?",  a: "จะมีค่าใช้จ่ายเพิ่มขึ้นตาม **แพ็กเกจ** ที่คุณลูกค้าเลือกค่ะ แต่คุณจะได้รับฟีเจอร์เพิ่มขึ้น X, Y, Z ค่ะ ซึ่งจะระบุในตารางราคาอย่างชัดเจน ไม่มีการเรียกเก็บย้อนหลังค่ะ" },
                { id: "P3Q72", part: 3, q: "ฉันจะติดต่อคุณได้อย่างไร หากมีปัญหา?",  a: "คุณสามารถติดต่อดิฉันโดยตรงที่เบอร์นี้ได้ตลอดเวลาทำการค่ะ หรือฝ่ายสนับสนุนของเราพร้อมให้บริการ **24/7** ผ่านช่องทางโทรศัพท์ อีเมล และ Chat Support ค่ะ" },
                { id: "P3Q73", part: 3, q: "ผลิตภัณฑ์ของคุณเข้ากับระบบปัจจุบันของฉันได้ไหม?",  a: "แน่นอนค่ะ ผลิตภัณฑ์ของเราออกแบบให้ใช้งานร่วมกับ **'โปรแกรม/ระบบปฏิบัติการ'** ที่คุณลูกค้าใช้อยู่ได้อย่างไม่มีปัญหา และมี API สำหรับการเชื่อมต่อพิเศษด้วยค่ะ" },
                { id: "P3Q74", part: 3, q: "ฉันไม่ชอบวิธีการขายแบบนี้เลย",  a: "ขออภัยค่ะ ดิฉันจะปรับวิธีการนำเสนอให้เป็นไปตามที่คุณลูกค้าต้องการ **คุณลูกค้าสะดวกให้ดิฉันพูดถึง 'ประโยชน์' หรือ 'ราคา' ก่อนดีคะ?**" },
                { id: "P3Q75", part: 3, q: "ฉันต้องการคุยกับเจ้าของบริษัท",  a: "ตอนนี้เจ้าของไม่สะดวกให้ติดต่อโดยตรงค่ะ มีเรื่องด่วนที่ดิฉันสามารถช่วยเหลือและ **ตัดสินใจแทน** ได้ไหมคะ? หากจำเป็นจริงๆ ดิฉันจะขอให้ผู้จัดการติดต่อไปค่ะ" },
                { id: "P3Q76", part: 3, q: "คุณแน่ใจได้อย่างไรว่ามันจะช่วยฉันได้จริง?",  a: "เรามีสถิติที่ชัดเจนจากลูกค้าที่ **คล้ายกับคุณลูกค้า (Case Study)** ค่ะ โดยเฉพาะเรื่อง **'ปัญหา X'** เราสามารถลดต้นทุนได้ถึง 20% ค่ะ คุณลูกค้าอยากให้ดิฉันส่งรายงานนี้ให้ดูไหมคะ?" },
                { id: "P3Q77", part: 3, q: "ฉันต้องการให้คุณเสนอสิ่งที่ดีกว่านี้",  a: "ขอทราบว่าสิ่งที่คุณต้องการเพิ่มเติมคืออะไรคะ? **(ฟังอย่างตั้งใจ)** เราอาจจะมีแพ็กเกจพรีเมียมที่ตอบโจทย์ของคุณได้มากกว่า หรือสามารถปรับแต่งบางฟีเจอร์ให้คุณโดยเฉพาะค่ะ" },
                { id: "P3Q78", part: 3, q: "ฉันจะรู้ได้อย่างไรว่าคุณจะไม่ทิ้งฉัน?",  a: "เราให้ความสำคัญกับลูกค้าหลังการขายมากค่ะ เรามีทีมงานที่ดูแลคุณโดยเฉพาะตลอดระยะสัญญา **คุณสามารถติดต่อผู้จัดการบัญชีของคุณได้โดยตรง** เพื่อความสบายใจค่ะ" },
                { id: "P3Q79", part: 3, q: "มีข้อจำกัดในการใช้งานอะไรบ้าง?",  a: "มีข้อจำกัดด้าน **'จำนวนผู้ใช้ 10 คน'** ค่ะ แต่เราได้ระบุไว้อย่างชัดเจนในคู่มือการใช้งานแล้ว หากเกินกว่านั้นก็สามารถอัปเกรดได้เลยค่ะ" },
                { id: "P3Q80", part: 3, q: "ฉันไม่ต้องการให้คุณโทรมาอีก",  a: "ดิฉันรับทราบค่ะ และจะนำเบอร์ของคุณลูกค้าออกจากระบบการติดต่อทันทีค่ะ ขออภัยที่รบกวนนะคะ และหวังว่าจะมีโอกาสได้บริการคุณลูกค้าในอนาคตค่ะ (ปิดการขายอย่างสุภาพ)" },
                { id: "P3Q81", part: 3, q: "บริการของคุณใช้ได้แค่บางพื้นที่ใช่ไหม?",  a: "บริการของเราเป็น **ระบบออนไลน์** ค่ะ สามารถใช้งานได้ทุกพื้นที่ทั่วโลก ตราบใดที่มีอินเทอร์เน็ตค่ะ ไม่ได้จำกัดแค่บางพื้นที่นะคะ" },
                { id: "P3Q82", part: 3, q: "ฉันไม่ต้องการให้มีโฆษณาแทรก",  a: "แพ็กเกจของเราเป็นแบบพรีเมียม ไม่มีโฆษณาแทรกอย่างแน่นอนค่ะ คุณจะได้รับประสบการณ์เต็มรูปแบบที่ลื่นไหลและมีประสิทธิภาพสูงสุดค่ะ" },
                { id: "P3Q83", part: 3, q: "คุณมีใบอนุญาต/มาตรฐานรับรองไหม?",  a: "แน่นอนค่ะ เราได้รับการรับรอง **มาตรฐานด้านความปลอดภัย** และ **คุณภาพจาก (สถาบัน/หน่วยงาน)** ค่ะ และเราจะส่งเอกสารการรับรองให้คุณลูกค้าดูได้ค่ะ" },
                { id: "P3Q84", part: 3, q: "ฉันกลัวว่าไฟล์เสียงจะใช้พื้นที่เยอะ",  a: "ไฟล์เสียงของเราถูกบีบอัดให้มีขนาดเล็ก แต่คุณภาพสูงเพื่อประหยัดพื้นที่ค่ะ โดยทั่วไป **1 ชั่วโมงจะใช้พื้นที่เพียง 10MB** เท่านั้นค่ะ" },
                { id: "P3Q85", part: 3, q: "คุณให้ส่วนลดพิเศษในวันเกิดไหม?",  a: "เรามีโปรโมชั่นพิเศษสำหรับลูกค้าปัจจุบันและ **โปรแกรมสะสมคะแนน** ที่สามารถแลกเป็นส่วนลดในโอกาสพิเศษได้ค่ะ แต่ข้อเสนอที่เราให้วันนี้ดีกว่าค่ะ" },
                { id: "P3Q86", part: 3, q: "ฉันไม่มีเวลาอ่านอีเมลที่คุณส่งมา",  a: "ไม่เป็นไรค่ะ ดิฉันขอสรุปสั้น ๆ ทางโทรศัพท์เลยนะคะ (เน้นย้ำแค่ 3 ประเด็นสำคัญ) **1. ประหยัดเงิน 2. ประหยัดเวลา 3. ได้รับบริการหลังการขาย 24 ชั่วโมง** ค่ะ" },
                { id: "P3Q87", part: 3, q: "ผลิตภัณฑ์ของคุณมีการอัปเดตบ่อยไหม?",  a: "เรามีการอัปเดตฟีเจอร์ใหม่และแก้ไขข้อบกพร่องสม่ำเสมอ **ทุก ๆ 2 เดือน** ค่ะ โดยคุณลูกค้าจะได้รับการอัปเดตฟรีตลอดระยะสัญญาค่ะ" },
                { id: "P3Q88", part: 3, q: "ฉันอยากได้แบบสีอื่น/รูปแบบอื่น",  a: "เรามีตัวเลือกให้เลือก **5 สี** และ **3 รูปแบบ** ค่ะ รบกวนระบุสีหรือรูปแบบที่คุณลูกค้าต้องการหน่อยนะคะ ดิฉันจะส่งแคตตาล็อกให้ดูเพิ่มเติมค่ะ" },
                { id: "P3Q89", part: 3, q: "มันดูเหมือนหลอกลวง",  a: "ดิฉันเข้าใจที่คิดแบบนั้นค่ะ แต่เรามีหลักฐานและบริษัทที่ **น่าเชื่อถือ (ระบุชื่อบริษัท/หน่วยงานที่รับรอง)** คุณลูกค้าสามารถตรวจสอบประวัติการจดทะเบียนได้เลยค่ะ เราโปร่งใสและพร้อมพิสูจน์ค่ะ" },
                { id: "P3Q90", part: 3, q: "คุณทำอะไรกับข้อมูลส่วนตัวของฉัน?",  a: "ข้อมูลของคุณจะถูกเก็บเป็นความลับและใช้เพื่อ **'ปรับปรุงบริการและส่งมอบข้อมูลที่คุณสนใจ'** เท่านั้น เราปฏิบัติตามกฎหมาย PDPA อย่างเคร่งครัดค่ะ" }
            ]
        };


        // --- Global Variables ---
        // audioBlobs เก็บ Object ที่มี { blob, submitted: boolean }
        let audioBlobs = { part1: {}, part2: {}, part3: {} }; 
        let mediaRecorder;
        let audioChunks = [];
        let currentPart = 'part1'; 
        let shuffledQuestions = []; 
        let currentIndex = 0;

        const inputUserName = document.getElementById('inputUserName');
        const mainAlert = document.getElementById('mainAlert');
        const recordingStatus = document.getElementById('recordingStatus');
        const startRecBtn = document.getElementById('startRecBtn');
        const stopRecBtn = document.getElementById('stopRecBtn');
        const playbackAudio = document.getElementById('playbackAudio');
        const questionList = document.getElementById('questionList');
        const loadingOverlay = document.getElementById('loadingOverlay');
        const submitBtn = document.getElementById('submitBtn'); // ปุ่มส่งงานรวม (ตรวจสอบ)
        const questionPrompt = document.getElementById('questionPrompt');
        const requiredAnswer = document.getElementById('requiredAnswer');
        const sendQuestionBtn = document.getElementById('sendQuestionBtn'); // ปุ่มส่งคำตอบทีละข้อ


        // --- Helper Functions ---

        function showAlert(message, type = 'info') {
            mainAlert.innerHTML = message;
            mainAlert.className = `alert ${type}`;
            mainAlert.style.display = 'block';
            setTimeout(() => {
                mainAlert.style.display = 'none';
            }, 5000);
        }

        window.saveUserName = function() {
            localStorage.setItem('examUserName', inputUserName.value.trim());
            checkSubmitButtonStatus();
        }

        // --- Supabase Core Functions (Logic Unchanged) ---

        /**
         * @description อัปโหลดไฟล์เสียงไปยัง Supabase Storage ด้วยโครงสร้าง Path ที่ถูกต้อง
         */
        async function uploadAudioToSupabase(fileBlob, questionId, partKey, userName) {
            const partNum = partKey.replace('part', 'P');
            const safeUserName = userName.replace(/[^a-zA-Z0-9ก-ฮเ-์]/g, '_');
            const fileName = `${safeUserName}_${partNum}_${questionId}_${Date.now()}.webm`;
            
            // Path: responses/part1/P1Q1/ชื่อไฟล์.webm
            const filePath = `${partKey}/${questionId}/${fileName}`; 
            
            const audioFile = new File([fileBlob], fileName, { type: fileBlob.type });

            console.log(`Uploading file to: ${filePath}`);

            const { error } = await supabase.storage
                .from('responses')
                .upload(filePath, audioFile, {
                    cacheControl: '3600',
                    upsert: false
                });

            if (error) {
                console.error(`Upload error for ${questionId}:`, error.message);
                throw new Error(`Upload failed for ${questionId}: ${error.message}`);
            }

            const { data: { publicUrl } } = supabase.storage
                .from('responses')
                .getPublicUrl(filePath);

            console.log(`Uploaded file URL for ${questionId}: ${publicUrl}`);
            return publicUrl;
        }

        /**
         * @description อัปโหลดและส่งข้อมูลคำตอบสำหรับคำถามเดียวไปยัง Supabase
         */
        async function submitSingleResponse(blob, question, userName, partKey) {
            const questionId = question.id;

            // 1. อัปโหลดไฟล์
            const publicUrl = await uploadAudioToSupabase(blob, questionId, partKey, userName);

            // 2. เตรียมข้อมูลเพื่อ Insert เข้าตาราง 'voice_answers'
            const questionNumber = parseInt(questionId.replace(/[a-zA-Z]+/, ''));
            if (isNaN(questionNumber)) {
                throw new Error(`Invalid question ID format: ${questionId}`);
            }

            const responseToInsert = {
                user_id: userName, 
                exam_id: userName, 
                part: partKey, 
                question_number: questionNumber, 
                audio_url: publicUrl, 
                created_at: new Date().toISOString()
            };
            
            // 3. Insert เข้าตาราง 'voice_answers'
            const { error: insertError } = await supabase
                .from('voice_answers')
                .insert([responseToInsert]);

            if (insertError) {
                console.error('Database insert error (voice_answers):', insertError.message);
                throw new Error(`Database submission failed: ${insertError.message}`);
            }
            
            return questionNumber;
        }


        // --- UI and Navigation Functions (Logic Unchanged) ---
                
        function renderQuestionList() {
            questionList.innerHTML = '';
            shuffledQuestions.forEach((q, index) => {
                const item = document.createElement('div');
                item.className = 'question-item';
                item.id = `q-item-${index}`;
                // ใช้ window.displayQuestionFromList เพื่อให้เรียกจาก HTML ได้
                item.setAttribute('onclick', `displayQuestionFromList(${index})`); 
                
                const status = audioBlobs[currentPart][q.id];
                let statusIcon = '';
                let color = 'red';

                if (status) {
                    if (status.submitted) {
                        // สถานะ: ส่งสำเร็จ
                        statusIcon = '✓';
                        color = 'green';
                    } else {
                        // สถานะ: บันทึกแล้ว แต่ยังไม่ส่ง (รอตรวจสอบ)
                        statusIcon = '•';
                        color = 'orange';
                    }
                } else {
                    // สถานะ: ยังไม่บันทึก
                    statusIcon = '•';
                    color = 'red';
                }

                item.innerHTML = `ข้อที่ ${index + 1} <span class="status-icon" style="color: ${color};">${statusIcon}</span>`;
                
                if (index === currentIndex) {
                    item.classList.add('active');
                }
                
                questionList.appendChild(item);
            });
            // ตรวจสอบสถานะปุ่มส่งงานรวมทุกครั้งที่อัปเดตรายการ
            checkSubmitButtonStatus(); 
        }

        function updateQuestionUI(question) {
            document.getElementById('currentQuestionTitle').textContent = `Part ${question.part}: คำถามข้อที่ ${currentIndex + 1}`;
            
            questionPrompt.textContent = question.q; 
            requiredAnswer.innerHTML = question.a;
            
            // ตั้งค่าสถานะปุ่มและเสียง
            const status = audioBlobs[currentPart][question.id];
            playbackAudio.style.display = 'none';
            sendQuestionBtn.style.display = 'none';
            sendQuestionBtn.disabled = true;

            if (status) {
                const blob = status.blob;
                playbackAudio.src = URL.createObjectURL(blob);
                playbackAudio.style.display = 'block';

                if (status.submitted) {
                    // บันทึกและส่งสำเร็จแล้ว
                    recordingStatus.textContent = 'สถานะ: ส่งข้อมูลสำเร็จแล้ว (สามารถฟังหรือบันทึกใหม่เพื่อส่งซ้ำได้)';
                    sendQuestionBtn.textContent = 'บันทึกใหม่และส่งซ้ำ';
                    sendQuestionBtn.style.display = 'block';
                    sendQuestionBtn.disabled = false;
                } else {
                    // บันทึกแล้ว แต่ยังไม่ส่ง (รอการตรวจสอบ)
                    recordingStatus.textContent = 'สถานะ: บันทึกสำเร็จแล้ว! กรุณาฟังและกด "ส่งคำตอบข้อนี้"';
                    sendQuestionBtn.textContent = 'ส่งคำตอบข้อนี้ (บันทึกและส่ง)';
                    sendQuestionBtn.style.display = 'block';
                    sendQuestionBtn.disabled = false;
                }
            } else {
                // ยังไม่ได้บันทึก
                playbackAudio.src = '';
                recordingStatus.textContent = 'สถานะ: ยังไม่ได้เริ่มบันทึกเสียง';
                sendQuestionBtn.style.display = 'none';
            }
            
            startRecBtn.disabled = false;
            stopRecBtn.disabled = true;
            
            renderQuestionList();
        }

        function displayQuestion(index) {
            currentIndex = index;
            const question = shuffledQuestions[index];
            
            updateQuestionUI(question);
        }

        window.displayQuestionFromList = function(index) {
            if (mediaRecorder && mediaRecorder.state !== 'inactive') {
                if (!confirm('กรุณาหยุดบันทึกเสียงก่อนเปลี่ยนไปทำข้ออื่น')) {
                    return;
                }
                // ถ้ามีการบันทึกอยู่ ให้หยุดและบันทึกใน cache ก่อนเปลี่ยนข้อ
                if (mediaRecorder.state === 'recording') {
                    mediaRecorder.stop();
                    // mediaRecorder.onstop จะทำงานต่อ
                }
            }
            displayQuestion(index);
        };

        window.loadPart = function(partKey) {
            if (!inputUserName.value.trim()) {
                showAlert('กรุณากรอกชื่อ-นามสกุล/รหัสพนักงานก่อนเลือก Part', 'warning');
                return;
            }
            saveUserName();
            
            currentPart = partKey;
            currentIndex = 0;
            
            const allQuestions = questions[currentPart];
            shuffledQuestions = allQuestions; // ใช้คำถามทั้งหมดตามลำดับ
            
            document.getElementById('examArea').style.display = 'grid';
            
            document.querySelectorAll('.part-button').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`btn${partKey.charAt(0).toUpperCase() + partKey.slice(1)}`).classList.add('active');

            displayQuestion(currentIndex);
        };

        // --- Submission Control (Logic Unchanged) ---

        window.handleSingleSubmission = async function() {
            const question = shuffledQuestions[currentIndex];
            const questionId = question.id;
            const userName = inputUserName.value.trim();
            const status = audioBlobs[currentPart][questionId];
            
            if (!status || !status.blob) {
                showAlert('ไม่พบไฟล์เสียงที่บันทึกไว้สำหรับข้อนี้ กรุณาบันทึกใหม่', 'warning');
                return;
            }

            const audioBlob = status.blob;

            // UI: เริ่มต้นการส่งข้อมูล
            loadingOverlay.style.display = 'flex';
            recordingStatus.textContent = 'สถานะ: กำลังอัปโหลดและส่งข้อมูล...';
            sendQuestionBtn.disabled = true;

            try {
                // 💡 เรียกฟังก์ชันส่งข้อมูลแบบเดี่ยว
                const questionNum = await submitSingleResponse(audioBlob, question, userName, currentPart);
                
                // 1. Success UI & Update Cache
                loadingOverlay.style.display = 'none';
                
                // อัปเดตสถานะใน cache เป็น submitted: true
                audioBlobs[currentPart][questionId].submitted = true; 

                recordingStatus.textContent = 'สถานะ: ส่งข้อมูลสำเร็จแล้ว!';
                showAlert(`ส่ง Part ${currentPart.replace('part', '')} ข้อที่ ${questionNum} สำเร็จแล้ว!`, 'success');

            } catch (error) {
                // 2. Error UI
                loadingOverlay.style.display = 'none';
                console.error('Submission Error:', error);
                
                // อัปเดตสถานะใน cache เป็น submitted: false
                if (audioBlobs[currentPart][questionId]) {
                    audioBlobs[currentPart][questionId].submitted = false; 
                }

                recordingStatus.textContent = 'สถานะ: เกิดข้อผิดพลาดในการส่งข้อมูล! กรุณากด "ส่งคำตอบข้อนี้" อีกครั้ง';
                showAlert(`ส่งข้อมูลล้มเหลว: ${error.message}`, 'warning');

            } finally {
                // อัปเดต UI ไม่ว่าจะสำเร็จหรือล้มเหลว
                updateQuestionUI(question);
            }
        };


        // --- Recording Functions (Logic Unchanged) ---

        window.handleStartRecording = async function() {
            if (!inputUserName.value.trim()) {
                showAlert('กรุณากรอกชื่อ-นามสกุล/รหัสพนักงานก่อนเริ่มบันทึก', 'warning');
                return;
            }

            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream, { mimeType: 'audio/webm' });
                audioChunks = [];

                mediaRecorder.ondataavailable = event => {
                    audioChunks.push(event.data);
                };

                // 💡 mediaRecorder.onstop จะทำแค่บันทึก Blob ลง Cache และอัปเดต UI
                mediaRecorder.onstop = () => {
                    const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
                    audioChunks = [];
                    
                    const question = shuffledQuestions[currentIndex];
                    const questionId = question.id;
                    
                    // 1. บันทึก Blob ไว้ใน Cache (สถานะ submitted: false)
                    audioBlobs[currentPart][questionId] = { 
                        blob: audioBlob, 
                        submitted: false 
                    }; 

                    // 2. ต้องหยุด Track ของ Stream เพื่อปล่อยการใช้ไมโครโฟน
                    mediaRecorder.stream.getTracks().forEach(track => track.stop());
                    
                    updateQuestionUI(question); // อัปเดต UI เพื่อแสดงปุ่ม "ส่งคำตอบข้อนี้"
                    showAlert('บันทึกเสียงสำเร็จแล้ว! กรุณาตรวจสอบแล้วกด "ส่งคำตอบข้อนี้"', 'info');
                };

                mediaRecorder.onstart = () => {
                    recordingStatus.textContent = 'สถานะ: กำลังบันทึกเสียง...';
                    startRecBtn.disabled = true;
                    stopRecBtn.disabled = false;
                    playbackAudio.style.display = 'none';
                    sendQuestionBtn.style.display = 'none';
                    playbackAudio.src = '';
                };

                mediaRecorder.start();

            } catch (err) {
                console.error('Recording failed:', err);
                showAlert('ไม่สามารถเข้าถึงไมโครโฟนได้: ' + err.message, 'warning');
            }
        };

        window.handleStopRecording = function() {
            if (mediaRecorder && mediaRecorder.state === 'recording') {
                mediaRecorder.stop();
                // mediaRecorder.onstop จะทำงานต่อเพื่อบันทึก Blob
            }
        };

        // --- Submission & Upload (Final) (Logic Unchanged) ---

        function checkSubmitButtonStatus() {
            const totalQuestions = shuffledQuestions.length;
            // นับเฉพาะข้อที่มีสถานะ submitted: true
            const submittedCount = Object.values(audioBlobs[currentPart]).filter(s => s.submitted).length;

            submitBtn.textContent = `ส่งงาน Part ${currentPart.replace('part', '')} (ส่งแล้ว ${submittedCount}/${totalQuestions} ข้อ)`;

            // 💡 เงื่อนไขที่แก้ไข: ปุ่มจะถูกเปิดใช้งานหากมีการส่งข้อมูลสำเร็จอย่างน้อย 1 ข้อ
            if (submittedCount > 0) { 
                submitBtn.disabled = false;
            } else {
                submitBtn.disabled = true;
            }
        }

        window.submitExam = function() {
            const totalQuestions = shuffledQuestions.length;
            const submittedCount = Object.values(audioBlobs[currentPart]).filter(s => s.submitted).length;

            if (totalQuestions > 0 && submittedCount === totalQuestions) {
                showAlert(`Part ${currentPart.replace('part', '')} ส่งข้อมูลครบถ้วน ${submittedCount}/${totalQuestions} ข้อแล้ว! คุณสามารถเลือก Part อื่นเพื่อทำแบบทดสอบต่อได้เลย`, 'success');
            
                // ตั้งค่าหน้าจอเป็นหน้าเลือก Part ใหม่
                document.getElementById('examArea').style.display = 'none';
                document.getElementById('currentQuestionTitle').textContent = 'ส่งงานสำเร็จ';
                document.getElementById('questionPrompt').textContent = 'กรุณาเลือก Part อื่นเพื่อทำแบบทดสอบต่อ';
                document.getElementById('requiredAnswer').textContent = '';
                
            } else if (submittedCount > 0) {
                // กรณีที่เปิดปุ่มแล้ว แต่ยังส่งไม่ครบ 30 ข้อ: แสดงคำเตือน
                showAlert(`**คุณได้ส่งไปแล้ว ${submittedCount} ข้อ** แต่ยังมีคำตอบ ${totalQuestions - submittedCount} ข้อใน Part นี้ที่ยังไม่ได้ถูกส่ง กรุณาตรวจสอบและกด "ส่งคำตอบข้อนี้" ในแต่ละข้อให้ครบถ้วนก่อน`, 'warning');
            } else {
                 // กรณีที่ยังไม่มีการส่งไฟล์สำเร็จเลย
                showAlert(`ยังไม่มีการส่งไฟล์เสียงสำเร็จเลย กรุณาส่งอย่างน้อย 1 ข้อก่อน`, 'warning');
            }
        };


        // --- Initialization ---

        const storedUserName = localStorage.getItem('examUserName');
        if (storedUserName) {
            inputUserName.value = storedUserName;
        }

        // ตรวจสอบสถานะปุ่มส่งเมื่อโหลดหน้าเว็บ
        checkSubmitButtonStatus();

    </script>

</body>
</html>
